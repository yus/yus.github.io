<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAL Color Matching System</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #2c3e50 0%, #4a6491 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .color-input-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
        }
        
        .color-preview {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            border: 2px solid #ddd;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .color-inputs {
            flex: 1;
            min-width: 300px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
        }
        
        input[type="number"] {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        
        .hex-input {
            width: 120px;
            font-family: monospace;
        }
        
        .results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #3498db;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .result-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 1.1rem;
            color: #4a6491;
        }
        
        .color-samples {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .color-sample {
            height: 120px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .color-sample:hover {
            transform: translateY(-5px);
        }
        
        .sample-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .sample-code {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            border-top: 1px solid #e0e0e0;
            margin-top: 30px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
            color: #4a6491;
        }
        
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #c62828;
        }
        
        @media (max-width: 768px) {
            .color-input-section {
                flex-direction: column;
            }
            
            .color-preview {
                width: 100%;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>RAL Color Matching System</h1>
            <div class="subtitle">Accurate RAL color identification with official data</div>
        </header>
        
        <div class="content">
            <div id="loading" class="loading">
                Loading RAL color database...
            </div>
            
            <div id="error" class="error" style="display: none;">
                Unable to load RAL color data. Using fallback database.
            </div>
            
            <div id="color-interface" style="display: none;">
                <div class="color-input-section">
                    <div class="color-preview" id="color-preview"></div>
                    <div class="color-inputs">
                        <div class="input-group">
                            <label for="red">Red (0-255)</label>
                            <input type="range" id="red" min="0" max="255" value="180">
                            <input type="number" id="red-value" min="0" max="255" value="180">
                        </div>
                        <div class="input-group">
                            <label for="green">Green (0-255)</label>
                            <input type="range" id="green" min="0" max="255" value="120">
                            <input type="number" id="green-value" min="0" max="255" value="120">
                        </div>
                        <div class="input-group">
                            <label for="blue">Blue (0-255)</label>
                            <input type="range" id="blue" min="0" max="255" value="60">
                            <input type="number" id="blue-value" min="0" max="255" value="60">
                        </div>
                        <div class="input-group">
                            <label for="hex">Hex Code</label>
                            <input type="text" id="hex" class="hex-input" value="#b4783c">
                        </div>
                    </div>
                </div>
                
                <div class="results">
                    <div class="result-item">
                        <div class="result-label">Closest RAL Match</div>
                        <div class="result-value" id="closest-match">RAL 8002 - Signal brown</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Color Distance</div>
                        <div class="result-value" id="color-distance">12.5 (Very Close)</div>
                    </div>
                </div>
                
                <h3>Closest RAL Color Matches</h3>
                <div class="color-samples" id="color-samples">
                    <!-- Color samples will be generated here -->
                </div>
            </div>
        </div>
        
        <footer>
            <p>RAL Color Matching System &copy; 2023 | Data sourced from RAL Farben</p>
        </footer>
    </div>

    <script>
        // Fallback RAL color database (in case HTTP request fails)
        const fallbackRalColors = [
            { code: "RAL 1000", name: "Green beige", hex: "#cdba88" },
            { code: "RAL 1001", name: "Beige", hex: "#d0b084" },
            { code: "RAL 1002", name: "Sand yellow", hex: "#d2aa6d" },
            { code: "RAL 1003", name: "Signal yellow", hex: "#f9a800" },
            { code: "RAL 1004", name: "Golden yellow", hex: "#e49e00" },
            { code: "RAL 1005", name: "Honey yellow", hex: "#cb8e00" },
            { code: "RAL 1006", name: "Maize yellow", hex: "#e29000" },
            { code: "RAL 1007", name: "Daffodil yellow", hex: "#e88c00" },
            { code: "RAL 1011", name: "Brown beige", hex: "#af804f" },
            { code: "RAL 1012", name: "Lemon yellow", hex: "#ddaf27" },
            { code: "RAL 1013", name: "Oyster white", hex: "#e3d9c6" },
            { code: "RAL 1014", name: "Ivory", hex: "#ded09f" },
            { code: "RAL 1015", name: "Light ivory", hex: "#eadebd" },
            { code: "RAL 1016", name: "Sulfur yellow", hex: "#faf594" },
            { code: "RAL 1017", name: "Saffron yellow", hex: "#f4a900" },
            { code: "RAL 1018", name: "Zinc yellow", hex: "#f3c300" },
            { code: "RAL 1019", name: "Grey beige", hex: "#a68f70" },
            { code: "RAL 1020", name: "Olive yellow", hex: "#9d8e61" },
            { code: "RAL 1021", name: "Rape yellow", hex: "#e1c300" },
            { code: "RAL 1023", name: "Traffic yellow", hex: "#f4b800" },
            { code: "RAL 1024", name: "Ochre yellow", hex: "#ba8f4c" },
            { code: "RAL 1026", name: "Luminous yellow", hex: "#ffff00" },
            { code: "RAL 1027", name: "Curry", hex: "#a77f0e" },
            { code: "RAL 1028", name: "Melon yellow", hex: "#ff9b00" },
            { code: "RAL 1032", name: "Broom yellow", hex: "#e2a300" },
            { code: "RAL 1033", name: "Dahlia yellow", hex: "#f99a1c" },
            { code: "RAL 1034", name: "Pastel yellow", hex: "#eb9c52" },
            { code: "RAL 1035", name: "Pearl beige", hex: "#908370" },
            { code: "RAL 1036", name: "Pearl gold", hex: "#80643f" },
            { code: "RAL 1037", name: "Sun yellow", hex: "#f09200" },
            { code: "RAL 2000", name: "Yellow orange", hex: "#da6e00" },
            { code: "RAL 2001", name: "Red orange", hex: "#b9490e" },
            { code: "RAL 2002", name: "Vermilion", hex: "#b73214" },
            { code: "RAL 2003", name: "Pastel orange", hex: "#ff6d1c" },
            { code: "RAL 2004", name: "Pure orange", hex: "#ff4600" },
            { code: "RAL 2005", name: "Luminous orange", hex: "#ff4200" },
            { code: "RAL 2007", name: "Luminous bright orange", hex: "#ffb200" },
            { code: "RAL 2008", name: "Bright red orange", hex: "#ff7c1c" },
            { code: "RAL 2009", name: "Traffic orange", hex: "#f54021" },
            { code: "RAL 2010", name: "Signal orange", hex: "#d84a1b" },
            { code: "RAL 2011", name: "Deep orange", hex: "#ec7c26" },
            { code: "RAL 2012", name: "Salmon orange", hex: "#e55137" },
            { code: "RAL 2013", name: "Pearl orange", hex: "#c35831" },
            { code: "RAL 3000", name: "Flame red", hex: "#a72920" },
            { code: "RAL 3001", name: "Signal red", hex: "#9b2423" },
            { code: "RAL 3002", name: "Carmine red", hex: "#9b2321" },
            { code: "RAL 3003", name: "Ruby red", hex: "#861a22" },
            { code: "RAL 3004", name: "Purple red", hex: "#6b1c23" },
            { code: "RAL 3005", name: "Wine red", hex: "#59191f" },
            { code: "RAL 3007", name: "Black red", hex: "#3e2022" },
            { code: "RAL 3009", name: "Oxide red", hex: "#6d342d" },
            { code: "RAL 3011", name: "Brown red", hex: "#792423" },
            { code: "RAL 3012", name: "Beige red", hex: "#c6846d" },
            { code: "RAL 3013", name: "Tomato red", hex: "#972e25" },
            { code: "RAL 3014", name: "Antique pink", hex: "#e1a6ad" },
            { code: "RAL 3015", name: "Light pink", hex: "#da9596" },
            { code: "RAL 3016", name: "Coral red", hex: "#d15b5b" },
            { code: "RAL 3017", name: "Rose", hex: "#b44041" },
            { code: "RAL 3018", name: "Strawberry red", hex: "#bb3d42" },
            { code: "RAL 3020", name: "Traffic red", hex: "#bc2f3b" },
            { code: "RAL 3022", name: "Salmon pink", hex: "#cf4f51" },
            { code: "RAL 3024", name: "Luminous red", hex: "#ff0000" },
            { code: "RAL 3026", name: "Luminous bright red", hex: "#ff2b2b" },
            { code: "RAL 3027", name: "Raspberry red", hex: "#ab273c" },
            { code: "RAL 3028", name: "Pure red", hex: "#cc2c24" },
            { code: "RAL 3031", name: "Orient red", hex: "#a63437" },
            { code: "RAL 3032", name: "Pearl ruby red", hex: "#701d29" },
            { code: "RAL 3033", name: "Pearl pink", hex: "#a53a2d" },
            { code: "RAL 4001", name: "Red lilac", hex: "#816183" },
            { code: "RAL 4002", name: "Red violet", hex: "#8d3c4b" },
            { code: "RAL 4003", name: "Heather violet", hex: "#c4618c" },
            { code: "RAL 4004", name: "Claret violet", hex: "#651e38" },
            { code: "RAL 4005", name: "Blue lilac", hex: "#76689a" },
            { code: "RAL 4006", name: "Traffic purple", hex: "#903373" },
            { code: "RAL 4007", name: "Purple violet", hex: "#47243c" },
            { code: "RAL 4008", name: "Signal violet", hex: "#844c82" },
            { code: "RAL 4009", name: "Pastel violet", hex: "#9d8692" },
            { code: "RAL 4010", name: "Telemagenta", hex: "#bc4077" },
            { code: "RAL 4011", name: "Pearl violet", hex: "#6e6387" },
            { code: "RAL 4012", name: "Pearl blackberry", hex: "#6b6b7b" },
            { code: "RAL 5000", name: "Violet blue", hex: "#314f6f" },
            { code: "RAL 5001", name: "Green blue", hex: "#0f4c64" },
            { code: "RAL 5002", name: "Ultramarine blue", hex: "#00387b" },
            { code: "RAL 5003", name: "Sapphire blue", hex: "#1f3057" },
            { code: "RAL 5004", name: "Black blue", hex: "#191e28" },
            { code: "RAL 5005", name: "Signal blue", hex: "#005387" },
            { code: "RAL 5007", name: "Brilliant blue", hex: "#376b8c" },
            { code: "RAL 5008", name: "Grey blue", hex: "#2b3a44" },
            { code: "RAL 5009", name: "Azure blue", hex: "#1a5798" },
            { code: "RAL 5010", name: "Gentian blue", hex: "#0d2f52" },
            { code: "RAL 5011", name: "Steel blue", hex: "#231d21" },
            { code: "RAL 5012", name: "Light blue", hex: "#3c88af" },
            { code: "RAL 5013", name: "Cobalt blue", hex: "#1e2b6b" },
            { code: "RAL 5014", name: "Pigeon blue", hex: "#6391ac" },
            { code: "RAL 5015", name: "Sky blue", hex: "#1e8bb7" },
            { code: "RAL 5017", name: "Traffic blue", hex: "#005b8c" },
            { code: "RAL 5018", name: "Turquoise blue", hex: "#0a434f" },
            { code: "RAL 5019", name: "Capri blue", hex: "#3a89b3" },
            { code: "RAL 5020", name: "Ocean blue", hex: "#1c2e3d" },
            { code: "RAL 5021", name: "Water blue", hex: "#006f7c" },
            { code: "RAL 5022", name: "Night blue", hex: "#2a2d36" },
            { code: "RAL 5023", name: "Distant blue", hex: "#9ba0a4" },
            { code: "RAL 5024", name: "Pastel blue", hex: "#4d6178" },
            { code: "RAL 5025", name: "Pearl gentian blue", hex: "#1a3a5c" },
            { code: "RAL 5026", name: "Pearl night blue", hex: "#0c2c4d" },
            { code: "RAL 6000", name: "Patina green", hex: "#327a70" },
            { code: "RAL 6001", name: "Emerald green", hex: "#287233" },
            { code: "RAL 6002", name: "Leaf green", hex: "#276235" },
            { code: "RAL 6003", name: "Olive green", hex: "#4b573c" },
            { code: "RAL 6004", name: "Blue green", hex: "#0e4243" },
            { code: "RAL 6005", name: "Moss green", hex: "#0f4336" },
            { code: "RAL 6006", name: "Grey olive", hex: "#40433b" },
            { code: "RAL 6007", name: "Bottle green", hex: "#283424" },
            { code: "RAL 6008", name: "Brown green", hex: "#35382e" },
            { code: "RAL 6009", name: "Fir green", hex: "#26392f" },
            { code: "RAL 6010", name: "Grass green", hex: "#3e753b" },
            { code: "RAL 6011", name: "Reseda green", hex: "#68825a" },
            { code: "RAL 6012", name: "Black green", hex: "#31403d" },
            { code: "RAL 6013", name: "Reed green", hex: "#797c5a" },
            { code: "RAL 6014", name: "Yellow olive", hex: "#444337" },
            { code: "RAL 6015", name: "Black olive", hex: "#3d403a" },
            { code: "RAL 6016", name: "Turquoise green", hex: "#026a52" },
            { code: "RAL 6017", name: "May green", hex: "#468641" },
            { code: "RAL 6018", name: "Yellow green", hex: "#48a43f" },
            { code: "RAL 6019", name: "Pastel green", hex: "#b7d9b1" },
            { code: "RAL 6020", name: "Chrome green", hex: "#354733" },
            { code: "RAL 6021", name: "Pale green", hex: "#86a47c" },
            { code: "RAL 6022", name: "Olive drab", hex: "#3e3c32" },
            { code: "RAL 6024", name: "Traffic green", hex: "#008754" },
            { code: "RAL 6025", name: "Fern green", hex: "#53753c" },
            { code: "RAL 6026", name: "Opal green", hex: "#005d4e" },
            { code: "RAL 6027", name: "Light green", hex: "#81c0bb" },
            { code: "RAL 6028", name: "Pine green", hex: "#2d5546" },
            { code: "RAL 6029", name: "Mint green", hex: "#007243" },
            { code: "RAL 6032", name: "Signal green", hex: "#0f8558" },
            { code: "RAL 6033", name: "Mint turquoise", hex: "#478a84" },
            { code: "RAL 6034", name: "Pastel turquoise", hex: "#7fb0b2" },
            { code: "RAL 6035", name: "Pearl green", hex: "#1a4c43" },
            { code: "RAL 6036", name: "Pearl opal green", hex: "#0d5249" },
            { code: "RAL 6037", name: "Pure green", hex: "#008f39" },
            { code: "RAL 6038", name: "Luminous green", hex: "#00bb2d" },
            { code: "RAL 7000", name: "Squirrel grey", hex: "#78858b" },
            { code: "RAL 7001", name: "Silver grey", hex: "#8a9597" },
            { code: "RAL 7002", name: "Olive grey", hex: "#7e7b52" },
            { code: "RAL 7003", name: "Moss grey", hex: "#6c7059" },
            { code: "RAL 7004", name: "Signal grey", hex: "#969992" },
            { code: "RAL 7005", name: "Mouse grey", hex: "#646b63" },
            { code: "RAL 7006", name: "Beige grey", hex: "#6d6552" },
            { code: "RAL 7008", name: "Khaki grey", hex: "#6a5f31" },
            { code: "RAL 7009", name: "Green grey", hex: "#4d5645" },
            { code: "RAL 7010", name: "Tarpaulin grey", hex: "#434750" },
            { code: "RAL 7011", name: "Iron grey", hex: "#4e545b" },
            { code: "RAL 7012", name: "Basalt grey", hex: "#7d8476" },
            { code: "RAL 7013", name: "Brown grey", hex: "#8d8a81" },
            { code: "RAL 7015", name: "Slate grey", hex: "#6f6e68" },
            { code: "RAL 7016", name: "Anthracite grey", hex: "#474a51" },
            { code: "RAL 7021", name: "Black grey", hex: "#3b3d3f" },
            { code: "RAL 7022", name: "Umbra grey", hex: "#1e2024" },
            { code: "RAL 7023", name: "Concrete grey", hex: "#969992" },
            { code: "RAL 7024", name: "Graphite grey", hex: "#474a51" },
            { code: "RAL 7026", name: "Granite grey", hex: "#2f353b" },
            { code: "RAL 7030", name: "Stone grey", hex: "#8b8c7a" },
            { code: "RAL 7031", name: "Blue grey", hex: "#474b4e" },
            { code: "RAL 7032", name: "Pebble grey", hex: "#b8b7a3" },
            { code: "RAL 7033", name: "Cement grey", hex: "#7d8471" },
            { code: "RAL 7034", name: "Yellow grey", hex: "#8f8b66" },
            { code: "RAL 7035", name: "Light grey", hex: "#c5c7c4" },
            { code: "RAL 7036", name: "Platinum grey", hex: "#9ca0a6" },
            { code: "RAL 7037", name: "Dusty grey", hex: "#7a7b7a" },
            { code: "RAL 7038", name: "Agate grey", hex: "#b5b8b1" },
            { code: "RAL 7039", name: "Quartz grey", hex: "#6c6960" },
            { code: "RAL 7040", name: "Window grey", hex: "#9da1aa" },
            { code: "RAL 7042", name: "Traffic grey A", hex: "#8d948d" },
            { code: "RAL 7043", name: "Traffic grey B", hex: "#4e5452" },
            { code: "RAL 7044", name: "Silk grey", hex: "#bdbdb2" },
            { code: "RAL 7045", name: "Telegrey 1", hex: "#91969c" },
            { code: "RAL 7046", name: "Telegrey 2", hex: "#82898e" },
            { code: "RAL 7047", name: "Telegrey 4", hex: "#c8c8c7" },
            { code: "RAL 7048", name: "Pearl mouse grey", hex: "#898176" },
            { code: "RAL 8000", name: "Green brown", hex: "#826c34" },
            { code: "RAL 8001", name: "Ochre brown", hex: "#955f20" },
            { code: "RAL 8002", name: "Signal brown", hex: "#6c3b2a" },
            { code: "RAL 8003", name: "Clay brown", hex: "#734222" },
            { code: "RAL 8004", name: "Copper brown", hex: "#8e402a" },
            { code: "RAL 8007", name: "Fawn brown", hex: "#59351f" },
            { code: "RAL 8008", name: "Olive brown", hex: "#6f4f28" },
            { code: "RAL 8011", name: "Nut brown", hex: "#5b3a29" },
            { code: "RAL 8012", name: "Red brown", hex: "#592321" },
            { code: "RAL 8014", name: "Sepia brown", hex: "#3a2a1a" },
            { code: "RAL 8015", name: "Chestnut brown", hex: "#604a33" },
            { code: "RAL 8016", name: "Mahogany brown", hex: "#44322d" },
            { code: "RAL 8017", name: "Chocolate brown", hex: "#3d362d" },
            { code: "RAL 8019", name: "Grey brown", hex: "#1a1718" },
            { code: "RAL 8022", name: "Black brown", hex: "#1a1718" },
            { code: "RAL 8023", name: "Orange brown", hex: "#a45729" },
            { code: "RAL 8024", name: "Beige brown", hex: "#795038" },
            { code: "RAL 8025", name: "Pale brown", hex: "#755c48" },
            { code: "RAL 8028", name: "Terracotta", hex: "#963b20" },
            { code: "RAL 8029", name: "Pearl copper", hex: "#6c3b2a" },
            { code: "RAL 9001", name: "Cream", hex: "#efe3cc" },
            { code: "RAL 9002", name: "Grey white", hex: "#ddded4" },
            { code: "RAL 9003", name: "Signal white", hex: "#f4f4f4" },
            { code: "RAL 9004", name: "Signal black", hex: "#2a2b2c" },
            { code: "RAL 9005", name: "Jet black", hex: "#0a0a0a" },
            { code: "RAL 9006", name: "White aluminium", hex: "#a5a5a5" },
            { code: "RAL 9007", name: "Grey aluminium", hex: "#8f8f8f" },
            { code: "RAL 9010", name: "Pure white", hex: "#f7f7f7" },
            { code: "RAL 9011", name: "Graphite black", hex: "#292c2f" },
            { code: "RAL 9016", name: "Traffic white", hex: "#f7f7f7" },
            { code: "RAL 9017", name: "Traffic black", hex: "#2a2b2c" },
            { code: "RAL 9018", name: "Papyrus white", hex: "#cfd3cd" }
        ];

        // Function to calculate color distance (CIEDE2000 algorithm for better accuracy)
        function colorDistance(r1, g1, b1, r2, g2, b2) {
            // Convert RGB to LAB color space for more accurate distance calculation
            const lab1 = rgbToLab(r1, g1, b1);
            const lab2 = rgbToLab(r2, g2, b2);
            
            // Calculate Delta E using CIEDE2000 formula
            return deltaE(lab1, lab2);
        }

        // RGB to LAB conversion
        function rgbToLab(r, g, b) {
            // First convert RGB to XYZ
            r = r / 255;
            g = g / 255;
            b = b / 255;
            
            r = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;
            g = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;
            b = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;
            
            r = r * 100;
            g = g * 100;
            b = b * 100;
            
            const x = r * 0.4124 + g * 0.3576 + b * 0.1805;
            const y = r * 0.2126 + g * 0.7152 + b * 0.0722;
            const z = r * 0.0193 + g * 0.1192 + b * 0.9505;
            
            // Then convert XYZ to LAB
            const xRef = 95.047;
            const yRef = 100.000;
            const zRef = 108.883;
            
            let xLab = x / xRef;
            let yLab = y / yRef;
            let zLab = z / zRef;
            
            xLab = xLab > 0.008856 ? Math.pow(xLab, 1/3) : (7.787 * xLab) + (16 / 116);
            yLab = yLab > 0.008856 ? Math.pow(yLab, 1/3) : (7.787 * yLab) + (16 / 116);
            zLab = zLab > 0.008856 ? Math.pow(zLab, 1/3) : (7.787 * zLab) + (16 / 116);
            
            const l = (116 * yLab) - 16;
            const a = 500 * (xLab - yLab);
            const bLab = 200 * (yLab - zLab);
            
            return { l, a, b: bLab };
        }

        // CIEDE2000 color difference formula
        function deltaE(lab1, lab2) {
            const l1 = lab1.l, a1 = lab1.a, b1 = lab1.b;
            const l2 = lab2.l, a2 = lab2.a, b2 = lab2.b;
            
            const avgL = (l1 + l2) / 2;
            const c1 = Math.sqrt(a1 * a1 + b1 * b1);
            const c2 = Math.sqrt(a2 * a2 + b2 * b2);
            const avgC = (c1 + c2) / 2;
            
            const g = 0.5 * (1 - Math.sqrt(Math.pow(avgC, 7) / (Math.pow(avgC, 7) + Math.pow(25, 7))));
            const a1p = a1 * (1 + g);
            const a2p = a2 * (1 + g);
            
            const c1p = Math.sqrt(a1p * a1p + b1 * b1);
            const c2p = Math.sqrt(a2p * a2p + b2 * b2);
            const avgCp = (c1p + c2p) / 2;
            
            const h1p = Math.atan2(b1, a1p) * 180 / Math.PI;
            const h2p = Math.atan2(b2, a2p) * 180 / Math.PI;
            
            let avgHp;
            if (Math.abs(h1p - h2p) > 180) {
                avgHp = (h1p + h2p + 360) / 2;
            } else {
                avgHp = (h1p + h2p) / 2;
            }
            
            const t = 1 - 0.17 * Math.cos((avgHp - 30) * Math.PI / 180) +
                        0.24 * Math.cos(2 * avgHp * Math.PI / 180) +
                        0.32 * Math.cos((3 * avgHp + 6) * Math.PI / 180) -
                        0.20 * Math.cos((4 * avgHp - 63) * Math.PI / 180);
            
            let deltaHp = h2p - h1p;
            if (Math.abs(deltaHp) > 180) {
                if (h2p <= h1p) {
                    deltaHp += 360;
                } else {
                    deltaHp -= 360;
                }
            }
            
            const deltaLp = l2 - l1;
            const deltaCp = c2p - c1p;
            deltaHp = 2 * Math.sqrt(c1p * c2p) * Math.sin(deltaHp * Math.PI / 360);
            
            const sl = 1 + (0.015 * Math.pow(avgL - 50, 2)) / Math.sqrt(20 + Math.pow(avgL - 50, 2));
            const sc = 1 + 0.045 * avgCp;
            const sh = 1 + 0.015 * avgCp * t;
            
            const deltaTheta = 30 * Math.exp(-Math.pow((avgHp - 275) / 25, 2));
            const rc = 2 * Math.sqrt(Math.pow(avgCp, 7) / (Math.pow(avgCp, 7) + Math.pow(25, 7)));
            const rt = -rc * Math.sin(2 * deltaTheta * Math.PI / 180);
            
            const deltaE = Math.sqrt(
                Math.pow(deltaLp / sl, 2) +
                Math.pow(deltaCp / sc, 2) +
                Math.pow(deltaHp / sh, 2) +
                rt * (deltaCp / sc) * (deltaHp / sh)
            );
            
            return deltaE;
        }

        // Function to find closest color matches
        function findClosestColors(r, g, b, colorDatabase, count = 6) {
            // Create array with distances
            const colorsWithDistances = colorDatabase.map(color => {
                const rgb = hexToRgb(color.hex);
                const distance = colorDistance(r, g, b, rgb.r, rgb.g, rgb.b);
                return { ...color, distance };
            });
            
            // Sort by distance and return top matches
            return colorsWithDistances
                .sort((a, b) => a.distance - b.distance)
                .slice(0, count);
        }

        // Function to convert hex to RGB
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 0, b: 0 };
        }

        // Function to convert RGB to hex
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        // Function to update color preview and results
        function updateColor(ralColors) {
            const red = parseInt(document.getElementById('red').value);
            const green = parseInt(document.getElementById('green').value);
            const blue = parseInt(document.getElementById('blue').value);
            const hex = rgbToHex(red, green, blue);
            
            // Update hex input
            document.getElementById('hex').value = hex;
            
            // Update color preview
            document.getElementById('color-preview').style.backgroundColor = hex;
            
            // Find closest color matches
            const closestColors = findClosestColors(red, green, blue, ralColors, 6);
            const closestColor = closestColors[0];
            
            // Update results
            document.getElementById('closest-match').textContent = `${closestColor.code} - ${closestColor.name}`;
            
            // Update color distance with interpretation
            let distanceText = closestColor.distance.toFixed(2);
            if (closestColor.distance < 2) {
                distanceText += " (Very Close)";
            } else if (closestColor.distance < 5) {
                distanceText += " (Close)";
            } else if (closestColor.distance < 10) {
                distanceText += " (Fair)";
            } else {
                distanceText += " (Not Close)";
            }
            document.getElementById('color-distance').textContent = distanceText;
            
            // Update color samples
            updateColorSamples(closestColors);
        }

        // Function to update color samples
        function updateColorSamples(colors) {
            const container = document.getElementById('color-samples');
            container.innerHTML = '';
            
            colors.forEach(color => {
                const sample = document.createElement('div');
                sample.className = 'color-sample';
                sample.style.backgroundColor = color.hex;
                
                // Determine text color based on background brightness
                const rgb = hexToRgb(color.hex);
                const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
                sample.style.color = brightness > 128 ? 'black' : 'white';
                sample.style.textShadow = brightness > 128 ? '0 1px 3px rgba(255, 255, 255, 0.7)' : '0 1px 3px rgba(0, 0, 0, 0.5)';
                
                const name = document.createElement('div');
                name.className = 'sample-name';
                name.textContent = color.code;
                
                const code = document.createElement('div');
                code.className = 'sample-code';
                code.textContent = color.name;
                
                sample.appendChild(name);
                sample.appendChild(code);
                container.appendChild(sample);
            });
        }

        // Function to update from hex input
        function updateFromHex(ralColors) {
            const hex = document.getElementById('hex').value;
            
            // Validate hex format
            if (!/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hex)) return;
            
            const rgb = hexToRgb(hex);
            
            // Update sliders and number inputs
            document.getElementById('red').value = rgb.r;
            document.getElementById('red-value').value = rgb.r;
            document.getElementById('green').value = rgb.g;
            document.getElementById('green-value').value = rgb.g;
            document.getElementById('blue').value = rgb.b;
            document.getElementById('blue-value').value = rgb.b;
            
            // Update color
            updateColor(ralColors);
        }

        // Function to fetch RAL colors from the official website
        async function fetchRalColors() {
            try {
                // Using a CORS proxy to bypass cross-origin restrictions
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const targetUrl = 'https://www.ral-farben.de/en/all-ral-colours';
                
                const response = await fetch(proxyUrl + targetUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const html = await response.text();
                
                // Parse the HTML to extract RAL color data
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Extract color data from the page (this is a simplified example)
                // In a real implementation, you would need to parse the actual HTML structure
                const colorElements = doc.querySelectorAll('.color-item'); // This selector would need to be adjusted
                
                const ralColors = [];
                
                // If we can't extract colors from the page, use the fallback
                if (colorElements.length === 0) {
                    throw new Error('Could not parse color data from the website');
                }
                
                // Process each color element (this is a placeholder)
                colorElements.forEach(element => {
                    // Extract code, name, and hex value from the element
                    // This would need to be customized based on the actual HTML structure
                    const code = element.querySelector('.code')?.textContent || '';
                    const name = element.querySelector('.name')?.textContent || '';
                    const hex = element.querySelector('.hex')?.textContent || '';
                    
                    if (code && name && hex) {
                        ralColors.push({ code, name, hex });
                    }
                });
                
                return ralColors.length > 0 ? ralColors : fallbackRalColors;
            } catch (error) {
                console.error('Error fetching RAL colors:', error);
                return fallbackRalColors;
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', async function() {
            // Show loading message
            document.getElementById('loading').style.display = 'block';
            document.getElementById('color-interface').style.display = 'none';
            
            // Fetch RAL colors
            const ralColors = await fetchRalColors();
            
            // Hide loading message and show interface
            document.getElementById('loading').style.display = 'none';
            document.getElementById('color-interface').style.display = 'block';
            
            // If we're using fallback data, show an error message
            if (ralColors === fallbackRalColors) {
                document.getElementById('error').style.display = 'block';
            }
            
            // Set up event listeners
            document.getElementById('red').addEventListener('input', function() {
                document.getElementById('red-value').value = this.value;
                updateColor(ralColors);
            });
            
            document.getElementById('green').addEventListener('input', function() {
                document.getElementById('green-value').value = this.value;
                updateColor(ralColors);
            });
            
            document.getElementById('blue').addEventListener('input', function() {
                document.getElementById('blue-value').value = this.value;
                updateColor(ralColors);
            });
            
            document.getElementById('red-value').addEventListener('input', function() {
                document.getElementById('red').value = this.value;
                updateColor(ralColors);
            });
            
            document.getElementById('green-value').addEventListener('input', function() {
                document.getElementById('green').value = this.value;
                updateColor(ralColors);
            });
            
            document.getElementById('blue-value').addEventListener('input', function() {
                document.getElementById('blue').value = this.value;
                updateColor(ralColors);
            });
            
            document.getElementById('hex').addEventListener('input', function() {
                updateFromHex(ralColors);
            });
            
            // Initialize with default color
            updateColor(ralColors);
        });
    </script>
</body>
</html>
