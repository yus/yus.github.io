<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAL Color Matcher</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background-color: #f5f7fa;
            --card-background: #ffffff;
            --text-color: #333333;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .description {
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .color-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .input-group {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .color-preview {
            width: 100%;
            height: 60px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        input[type="range"] {
            flex: 1;
        }

        input[type="number"] {
            width: 70px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .hex-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            margin-top: 10px;
        }

        .results-section {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .color-card {
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            overflow: hidden;
            transition: var(--transition);
        }

        .color-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .color-swatch {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-weight: bold;
        }

        .color-info {
            padding: 15px;
        }

        .color-code {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .color-name {
            font-size: 0.9rem;
            color: #666;
        }

        .difference {
            margin-top: 5px;
            font-size: 0.8rem;
            color: #888;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .color-inputs {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>RAL Color Matcher</h1>
            <p class="description">Find the closest RAL colors to your input color. Adjust the RGB values or enter a hex code to see matching RAL colors from the RAL Design System Plus.</p>
        </header>

        <section class="input-section">
            <div class="color-inputs">
                <div class="input-group">
                    <h2>Input Color</h2>
                    <div class="color-preview" id="colorPreview"></div>
                    <div class="input-row">
                        <label>R:</label>
                        <input type="range" id="redSlider" min="0" max="255" value="120">
                        <input type="number" id="redInput" min="0" max="255" value="120">
                    </div>
                    <div class="input-row">
                        <label>G:</label>
                        <input type="range" id="greenSlider" min="0" max="255" value="120">
                        <input type="number" id="greenInput" min="0" max="255" value="120">
                    </div>
                    <div class="input-row">
                        <label>B:</label>
                        <input type="range" id="blueSlider" min="0" max="255" value="120">
                        <input type="number" id="blueInput" min="0" max="255" value="120">
                    </div>
                    <input type="text" id="hexInput" class="hex-input" placeholder="#787878" value="#787878">
                </div>

                <div class="input-group">
                    <h2>Settings</h2>
                    <div class="input-row">
                        <label for="resultsCount">Number of results:</label>
                        <input type="number" id="resultsCount" min="1" max="50" value="10">
                    </div>
                    <div class="input-row">
                        <label for="language">Language:</label>
                        <select id="language">
                            <option value="en">English</option>
                            <option value="ru">Russian</option>
                        </select>
                    </div>
                    <button id="findMatches" style="width: 100%; padding: 10px; background-color: var(--secondary-color); color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">Find Matching Colors</button>
                </div>
            </div>
        </section>

        <section class="results-section">
            <h2>Closest RAL Colors</h2>
            <div class="results-grid" id="resultsContainer">
                <!-- Results will be displayed here -->
            </div>
        </section>

        <footer>
            <p>RAL Color Matcher - Based on RAL Design System Plus | Data sources: 
                <a href="https://yus.github.io/RAL/ral-design-system-plus-farbnamen-en.txt" target="_blank">English names</a>, 
                <a href="https://yus.github.io/RAL/ral-design-system-plus-farbnamen-ru.txt" target="_blank">Russian names</a>, 
                <a href="https://yus.github.io/RAL/comprehensiveRAL.json" target="_blank">JSON data</a>
            </p>
        </footer>
    </div>

    <script>
        // Color data structure
        const colorData = {
            ralColors: [],
            language: 'en',
            colorNames: {
                en: {},
                ru: {}
            }
        };

        // DOM elements
        const elements = {
            redSlider: document.getElementById('redSlider'),
            redInput: document.getElementById('redInput'),
            greenSlider: document.getElementById('greenSlider'),
            greenInput: document.getElementById('greenInput'),
            blueSlider: document.getElementById('blueSlider'),
            blueInput: document.getElementById('blueInput'),
            hexInput: document.getElementById('hexInput'),
            colorPreview: document.getElementById('colorPreview'),
            resultsCount: document.getElementById('resultsCount'),
            language: document.getElementById('language'),
            findMatches: document.getElementById('findMatches'),
            resultsContainer: document.getElementById('resultsContainer')
        };

        // Initialize the application
        async function init() {
            await loadColorData();
            setupEventListeners();
            updateColorPreview();
            findMatchingColors();
        }

        // Load color data from external sources
        async function loadColorData() {
            try {
                // Load English color names
                const enResponse = await fetch('https://yus.github.io/RAL/ral-design-system-plus-farbnamen-en.txt');
                const enText = await enResponse.text();
                colorData.colorNames.en = parseColorNames(enText);
                
                // Load Russian color names
                const ruResponse = await fetch('https://yus.github.io/RAL/ral-design-system-plus-farbnamen-ru.txt');
                const ruText = await ruResponse.text();
                colorData.colorNames.ru = parseColorNames(ruText);
                
                // Load comprehensive RAL data
                const jsonResponse = await fetch('https://yus.github.io/RAL/comprehensiveRAL.json');
                const jsonData = await jsonResponse.json();
                colorData.ralColors = jsonData.colors || [];
                
                console.log('Color data loaded successfully');
            } catch (error) {
                console.error('Error loading color data:', error);
                // Fallback to sample data if external sources fail
                loadSampleData();
            }
        }

        // Parse color names from text format
        function parseColorNames(text) {
            const names = {};
            const lines = text.split('\n');
            
            for (const line of lines) {
                if (line.trim() === '') continue;
                
                const parts = line.split('\t');
                if (parts.length >= 2) {
                    const code = parts[0].trim();
                    const name = parts[1].trim();
                    names[code] = name;
                }
            }
            
            return names;
        }

        // Sample data for fallback
        function loadSampleData() {
            colorData.ralColors = [
                { code: "RAL 000 15 00", rgb: { r: 0, g: 0, b: 0 } },
                { code: "RAL 010 30 44", rgb: { r: 125, g: 57, b: 71 } },
                { code: "RAL 030 50 60", rgb: { r: 191, g: 98, b: 56 } },
                { code: "RAL 050 50 78", rgb: { r: 255, g: 132, b: 0 } },
                { code: "RAL 060 70 70", rgb: { r: 255, g: 175, b: 69 } },
                { code: "RAL 075 70 30", rgb: { r: 181, g: 178, b: 130 } },
                { code: "RAL 095 90 10", rgb: { r: 230, g: 229, b: 207 } },
                { code: "RAL 110 60 40", rgb: { r: 138, g: 162, b: 120 } },
                { code: "RAL 120 50 40", rgb: { r: 81, g: 130, b: 107 } },
                { code: "RAL 160 50 45", rgb: { r: 62, g: 140, b: 125 } },
                { code: "RAL 200 40 35", rgb: { r: 42, g: 108, b: 140 } },
                { code: "RAL 240 40 35", rgb: { r: 42, g: 92, b: 142 } },
                { code: "RAL 280 40 35", rgb: { r: 58, g: 71, b: 142 } },
                { code: "RAL 310 50 35", rgb: { r: 130, g: 102, b: 142 } },
                { code: "RAL 340 40 45", rgb: { r: 142, g: 56, b: 107 } },
                { code: "RAL 350 40 45", rgb: { r: 142, g: 56, b: 81 } }
            ];
            
            // Sample names
            colorData.colorNames.en = {
                "RAL 000 15 00": "Jet black",
                "RAL 010 30 44": "Amaranth purple",
                "RAL 030 50 60": "Pumpkin orange",
                "RAL 050 50 78": "Tangerine yellow",
                "RAL 060 70 70": "Marigold yellow",
                "RAL 075 70 30": "Pistachio green",
                "RAL 095 90 10": "Cream white",
                "RAL 110 60 40": "Sage green",
                "RAL 120 50 40": "Forest green",
                "RAL 160 50 45": "Turquoise green",
                "RAL 200 40 35": "Marine blue",
                "RAL 240 40 35": "Cobalt blue",
                "RAL 280 40 35": "Ultramarine blue",
                "RAL 310 50 35": "Lilac purple",
                "RAL 340 40 45": "Magenta pink",
                "RAL 350 40 45": "Raspberry red"
            };
            
            colorData.colorNames.ru = {
                "RAL 000 15 00": "Черный как смоль",
                "RAL 010 30 44": "Пурпурный амарант",
                "RAL 030 50 60": "Тыквенно-оранжевый",
                "RAL 050 50 78": "Мандариновый желтый",
                "RAL 060 70 70": "Желтый календулы",
                "RAL 075 70 30": "Фисташковый зеленый",
                "RAL 095 90 10": "Кремово-белый",
                "RAL 110 60 40": "Шалфейно-зеленый",
                "RAL 120 50 40": "Лесной зеленый",
                "RAL 160 50 45": "Бирюзово-зеленый",
                "RAL 200 40 35": "Морской синий",
                "RAL 240 40 35": "Кобальтовый синий",
                "RAL 280 40 35": "Ультрамариновый синий",
                "RAL 310 50 35": "Сиреневый",
                "RAL 340 40 45": "Пурпурно-розовый",
                "RAL 350 40 45": "Малиново-красный"
            };
        }

        // Set up event listeners for user interactions
        function setupEventListeners() {
            // RGB sliders and inputs
            elements.redSlider.addEventListener('input', updateRed);
            elements.redInput.addEventListener('input', updateRed);
            elements.greenSlider.addEventListener('input', updateGreen);
            elements.greenInput.addEventListener('input', updateGreen);
            elements.blueSlider.addEventListener('input', updateBlue);
            elements.blueInput.addEventListener('input', updateBlue);
            
            // Hex input
            elements.hexInput.addEventListener('input', updateFromHex);
            
            // Find matches button
            elements.findMatches.addEventListener('click', findMatchingColors);
            
            // Language selector
            elements.language.addEventListener('change', findMatchingColors);
        }

        // Update red value and sync inputs
        function updateRed() {
            const value = Math.min(255, Math.max(0, parseInt(elements.redSlider.value) || 0));
            elements.redSlider.value = value;
            elements.redInput.value = value;
            updateColorFromRGB();
        }

        // Update green value and sync inputs
        function updateGreen() {
            const value = Math.min(255, Math.max(0, parseInt(elements.greenSlider.value) || 0));
            elements.greenSlider.value = value;
            elements.greenInput.value = value;
            updateColorFromRGB();
        }

        // Update blue value and sync inputs
        function updateBlue() {
            const value = Math.min(255, Math.max(0, parseInt(elements.blueSlider.value) || 0));
            elements.blueSlider.value = value;
            elements.blueInput.value = value;
            updateColorFromRGB();
        }

        // Update color from RGB values
        function updateColorFromRGB() {
            const r = parseInt(elements.redInput.value);
            const g = parseInt(elements.greenInput.value);
            const b = parseInt(elements.blueInput.value);
            
            // Update hex input
            const hex = rgbToHex(r, g, b);
            elements.hexInput.value = hex;
            
            updateColorPreview();
        }

        // Update from hex input
        function updateFromHex() {
            const hex = elements.hexInput.value.replace('#', '');
            
            if (hex.length === 3 || hex.length === 6) {
                const rgb = hexToRgb(hex);
                if (rgb) {
                    elements.redSlider.value = rgb.r;
                    elements.redInput.value = rgb.r;
                    elements.greenSlider.value = rgb.g;
                    elements.greenInput.value = rgb.g;
                    elements.blueSlider.value = rgb.b;
                    elements.blueInput.value = rgb.b;
                    
                    updateColorPreview();
                }
            }
        }

        // Update color preview
        function updateColorPreview() {
            const r = parseInt(elements.redInput.value);
            const g = parseInt(elements.greenInput.value);
            const b = parseInt(elements.blueInput.value);
            
            elements.colorPreview.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
            
            // Adjust text color for better contrast
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            elements.colorPreview.style.color = brightness > 128 ? 'black' : 'white';
            elements.colorPreview.textContent = `RGB: ${r}, ${g}, ${b}`;
        }

        // Convert RGB to hex
        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = x.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        // Convert hex to RGB
        function hexToRgb(hex) {
            // Expand short hex notation
            if (hex.length === 3) {
                hex = hex.split('').map(x => x + x).join('');
            }
            
            const result = /^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        // Calculate color difference using Euclidean distance in RGB space
        function colorDifference(rgb1, rgb2) {
            const rDiff = rgb1.r - rgb2.r;
            const gDiff = rgb1.g - rgb2.g;
            const bDiff = rgb1.b - rgb2.b;
            
            return Math.sqrt(rDiff * rDiff + gDiff * gDiff + bDiff * bDiff);
        }

        // Find matching colors
        function findMatchingColors() {
            const inputRgb = {
                r: parseInt(elements.redInput.value),
                g: parseInt(elements.greenInput.value),
                b: parseInt(elements.blueInput.value)
            };
            
            const resultsCount = parseInt(elements.resultsCount.value) || 10;
            const language = elements.language.value;
            
            // Calculate differences for all RAL colors
            const colorsWithDifferences = colorData.ralColors.map(color => {
                const difference = colorDifference(inputRgb, color.rgb);
                return {
                    ...color,
                    difference: difference
                };
            });
            
            // Sort by difference (ascending)
            colorsWithDifferences.sort((a, b) => a.difference - b.difference);
            
            // Take top results
            const topMatches = colorsWithDifferences.slice(0, resultsCount);
            
            // Display results
            displayResults(topMatches, language);
        }

        // Display results in the UI
        function displayResults(matches, language) {
            elements.resultsContainer.innerHTML = '';
            
            if (matches.length === 0) {
                elements.resultsContainer.innerHTML = '<p>No matching colors found.</p>';
                return;
            }
            
            matches.forEach(match => {
                const colorCard = document.createElement('div');
                colorCard.className = 'color-card';
                
                const colorSwatch = document.createElement('div');
                colorSwatch.className = 'color-swatch';
                colorSwatch.style.backgroundColor = `rgb(${match.rgb.r}, ${match.rgb.g}, ${match.rgb.b})`;
                colorSwatch.textContent = match.code;
                
                const colorInfo = document.createElement('div');
                colorInfo.className = 'color-info';
                
                const colorCode = document.createElement('div');
                colorCode.className = 'color-code';
                colorCode.textContent = match.code;
                
                const colorName = document.createElement('div');
                colorName.className = 'color-name';
                colorName.textContent = colorData.colorNames[language][match.code] || 'Name not available';
                
                const difference = document.createElement('div');
                difference.className = 'difference';
                difference.textContent = `Difference: ${match.difference.toFixed(2)}`;
                
                colorInfo.appendChild(colorCode);
                colorInfo.appendChild(colorName);
                colorInfo.appendChild(difference);
                
                colorCard.appendChild(colorSwatch);
                colorCard.appendChild(colorInfo);
                
                elements.resultsContainer.appendChild(colorCard);
            });
        }

        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
