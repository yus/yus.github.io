<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAL Color Matcher with CMYK</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background-color: #f5f7fa;
            --card-background: #ffffff;
            --text-color: #333333;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .description {
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: var(--card-background);
            border: 2px solid var(--secondary-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }

        .nav-tab.active {
            background: var(--secondary-color);
            color: white;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .color-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .input-group {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .color-preview {
            width: 100%;
            height: 80px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .preview-values {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            text-align: center;
        }

        .preview-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .preview-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .input-row label {
            min-width: 30px;
            font-weight: bold;
        }

        input[type="range"] {
            flex: 1;
        }

        input[type="number"] {
            width: 70px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .hex-input, .cmyk-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            margin-top: 10px;
        }

        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }

        .tab-button.active {
            border-bottom-color: var(--secondary-color);
            color: var(--secondary-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .results-section {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .color-card {
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
        }

        .color-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .color-swatch {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-weight: bold;
            flex-direction: column;
            gap: 5px;
        }

        .color-info {
            padding: 15px;
        }

        .color-code {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .color-name {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            font-style: italic;
        }

        .color-name-ru {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 8px;
            font-style: italic;
        }

        .color-values {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.8rem;
        }

        .value-group {
            display: flex;
            flex-direction: column;
        }

        .value-label {
            font-weight: bold;
            color: #888;
        }

        .difference {
            margin-top: 5px;
            font-size: 0.8rem;
            color: #888;
            text-align: center;
            padding: 5px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .difference-low {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .difference-medium {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .difference-high {
            background-color: #ffebee;
            color: #c62828;
        }

        /* Catalog Page Styles */
        .catalog-controls {
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .catalog-search {
            flex: 1;
            min-width: 250px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .hue-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .hue-button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .hue-button.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .catalog-card {
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
        }

        .catalog-card.highlighted {
            animation: pulse 2s infinite;
            border: 3px solid var(--secondary-color);
        }

        .catalog-card.neighbor-highlight {
            border: 2px solid #3498db;
            transform: scale(1.05);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(52, 152, 219, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
        }

        .catalog-swatch {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-weight: bold;
        }

        .catalog-info {
            padding: 10px;
            font-size: 0.85rem;
        }

        .catalog-code {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .catalog-name {
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
            margin-bottom: 2px;
        }

        .catalog-name-ru {
            font-size: 0.75rem;
            color: #888;
            font-style: italic;
        }

        .section-header {
            background: var(--primary-color);
            color: white;
            padding: 15px 20px;
            margin: 30px 0 15px 0;
            border-radius: var(--border-radius);
            font-size: 1.2rem;
        }

        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--secondary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow);
            display: none;
        }

        .view-catalog-link {
            display: inline-block;
            margin-top: 10px;
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: bold;
        }

        .view-catalog-link:hover {
            text-decoration: underline;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .settings-group {
            margin-bottom: 15px;
        }

        .settings-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .slider-value {
            display: inline-block;
            width: 50px;
            text-align: right;
            font-weight: bold;
            color: var(--secondary-color);
        }

        @media (max-width: 768px) {
            .color-inputs {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .color-values {
                grid-template-columns: 1fr;
            }
            
            .preview-values {
                grid-template-columns: 1fr;
            }
            
            .catalog-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .catalog-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>RAL Color Matcher & Catalog</h1>
            <p class="description">Find the closest RAL colors or browse the complete RAL Design System Plus catalog with names in English and Russian.</p>
        </header>

        <div class="nav-tabs">
            <div class="nav-tab active" data-page="matcher">Color Matcher</div>
            <div class="nav-tab" data-page="catalog">Full Catalog</div>
        </div>

        <!-- Color Matcher Page -->
        <div class="page active" id="matcherPage">
            <section class="input-section">
                <div class="color-inputs">
                    <div class="input-group">
                        <h2>Input Color</h2>
                        <div class="color-preview" id="colorPreview">
                            <div class="preview-values">
                                <div class="preview-group">
                                    <div class="preview-label">RGB</div>
                                    <div>120, 120, 120</div>
                                </div>
                                <div class="preview-group">
                                    <div class="preview-label">CMYK</div>
                                    <div>0%, 0%, 0%, 53%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-buttons">
                            <button class="tab-button active" data-tab="rgb">RGB/HEX</button>
                            <button class="tab-button" data-tab="cmyk">CMYK</button>
                        </div>
                        
                        <div class="tab-content active" id="rgbTab">
                            <div class="input-row">
                                <label>R:</label>
                                <input type="range" id="redSlider" min="0" max="255" value="120">
                                <input type="number" id="redInput" min="0" max="255" value="120">
                            </div>
                            <div class="input-row">
                                <label>G:</label>
                                <input type="range" id="greenSlider" min="0" max="255" value="120">
                                <input type="number" id="greenInput" min="0" max="255" value="120">
                            </div>
                            <div class="input-row">
                                <label>B:</label>
                                <input type="range" id="blueSlider" min="0" max="255" value="120">
                                <input type="number" id="blueInput" min="0" max="255" value="120">
                            </div>
                            <input type="text" id="hexInput" class="hex-input" placeholder="#787878" value="#787878">
                        </div>
                        
                        <div class="tab-content" id="cmykTab">
                            <div class="input-row">
                                <label>C:</label>
                                <input type="range" id="cyanSlider" min="0" max="100" value="0">
                                <input type="number" id="cyanInput" min="0" max="100" value="0">%
                            </div>
                            <div class="input-row">
                                <label>M:</label>
                                <input type="range" id="magentaSlider" min="0" max="100" value="0">
                                <input type="number" id="magentaInput" min="0" max="100" value="0">%
                            </div>
                            <div class="input-row">
                                <label>Y:</label>
                                <input type="range" id="yellowSlider" min="0" max="100" value="0">
                                <input type="number" id="yellowInput" min="0" max="100" value="0">%
                            </div>
                            <div class="input-row">
                                <label>K:</label>
                                <input type="range" id="blackSlider" min="0" max="100" value="53">
                                <input type="number" id="blackInput" min="0" max="100" value="53">%
                            </div>
                            <input type="text" id="cmykInput" class="cmyk-input" placeholder="0,0,0,53" value="0,0,0,53">
                        </div>
                    </div>

                    <div class="input-group">
                        <h2>Settings</h2>
                        
                        <div class="settings-group">
                            <label for="resultsCount">
                                Number of results: <span class="slider-value" id="resultsCountValue">12</span>
                            </label>
                            <input type="range" id="resultsCount" min="1" max="50" value="12">
                        </div>
                        
                        <div class="settings-group">
                            <label for="maxDifference">
                                Max color difference: <span class="slider-value" id="maxDifferenceValue">100</span>
                            </label>
                            <input type="range" id="maxDifference" min="1" max="200" value="100">
                        </div>
                        
                        <button id="findMatches" style="width: 100%; padding: 10px; background-color: var(--secondary-color); color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">Find Matching Colors</button>
                    </div>
                </div>
            </section>

            <section class="results-section">
                <h2>Closest RAL Colors</h2>
                <a href="#" class="view-catalog-link" id="viewCatalogLink" style="display: none;">View this color in full catalog →</a>
                <div class="loading" id="loadingIndicator">Loading RAL color data...</div>
                <div class="results-grid" id="resultsContainer">
                    <!-- Results will be displayed here -->
                </div>
            </section>
        </div>

        <!-- Catalog Page -->
        <div class="page" id="catalogPage">
            <div class="catalog-controls">
                <input type="text" id="catalogSearch" class="catalog-search" placeholder="Search by RAL code or color name...">
                <div class="hue-filter">
                    <div class="hue-button active" data-hue="all">All Colors</div>
                    <div class="hue-button" data-hue="red">Reds</div>
                    <div class="hue-button" data-hue="orange">Oranges</div>
                    <div class="hue-button" data-hue="yellow">Yellows</div>
                    <div class="hue-button" data-hue="green">Greens</div>
                    <div class="hue-button" data-hue="blue">Blues</div>
                    <div class="hue-button" data-hue="purple">Purples</div>
                    <div class="hue-button" data-hue="neutral">Neutrals</div>
                </div>
            </div>

            <div class="loading" id="catalogLoading">Loading RAL catalog...</div>
            <div id="catalogContainer">
                <!-- Catalog will be displayed here -->
            </div>
        </div>

        <div class="back-to-top" id="backToTop">↑</div>

        <footer>
            <p>RAL Color Matcher & Catalog - Based on RAL Design System Plus | Data sources: 
                <a href="https://yus.github.io/RAL/ral-design-system-plus-farbnamen-en.txt" target="_blank">English names</a>, 
                <a href="https://yus.github.io/RAL/ral-design-system-plus-farbnamen-ru.txt" target="_blank">Russian names</a>
            </p>
        </footer>
    </div>

    <script>
        // Color data structure
        const colorData = {
            ralColors: [],
            loaded: false,
            currentHighlight: null
        };

        // DOM elements
        const elements = {
            // Navigation
            navTabs: document.querySelectorAll('.nav-tab'),
            pages: document.querySelectorAll('.page'),
            backToTop: document.getElementById('backToTop'),

            // Matcher page elements
            redSlider: document.getElementById('redSlider'),
            redInput: document.getElementById('redInput'),
            greenSlider: document.getElementById('greenSlider'),
            greenInput: document.getElementById('greenInput'),
            blueSlider: document.getElementById('blueSlider'),
            blueInput: document.getElementById('blueInput'),
            hexInput: document.getElementById('hexInput'),
            cyanSlider: document.getElementById('cyanSlider'),
            cyanInput: document.getElementById('cyanInput'),
            magentaSlider: document.getElementById('magentaSlider'),
            magentaInput: document.getElementById('magentaInput'),
            yellowSlider: document.getElementById('yellowSlider'),
            yellowInput: document.getElementById('yellowInput'),
            blackSlider: document.getElementById('blackSlider'),
            blackInput: document.getElementById('blackInput'),
            cmykInput: document.getElementById('cmykInput'),
            resultsCount: document.getElementById('resultsCount'),
            resultsCountValue: document.getElementById('resultsCountValue'),
            maxDifference: document.getElementById('maxDifference'),
            maxDifferenceValue: document.getElementById('maxDifferenceValue'),
            colorPreview: document.getElementById('colorPreview'),
            findMatches: document.getElementById('findMatches'),
            resultsContainer: document.getElementById('resultsContainer'),
            loadingIndicator: document.getElementById('loadingIndicator'),
            viewCatalogLink: document.getElementById('viewCatalogLink'),
            rgbTab: document.getElementById('rgbTab'),
            cmykTab: document.getElementById('cmykTab'),

            // Catalog page elements
            catalogSearch: document.getElementById('catalogSearch'),
            catalogLoading: document.getElementById('catalogLoading'),
            catalogContainer: document.getElementById('catalogContainer'),
            hueButtons: document.querySelectorAll('.hue-button')
        };

        // Initialize the application
        async function init() {
            setupNavigation();
            setupEventListeners();
            setupTabs();
            await loadColorData();
            updateColorPreview();
            findMatchingColors();
            
            // Pre-load catalog when page loads
            displayCatalog();
        }

        // Set up navigation between pages
        function setupNavigation() {
            elements.navTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const pageId = tab.getAttribute('data-page') + 'Page';
                    
                    // Update active tab
                    elements.navTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding page
                    elements.pages.forEach(page => page.classList.remove('active'));
                    document.getElementById(pageId).classList.add('active');
                    
                    // Ensure catalog is loaded when switching to catalog page
                    if (pageId === 'catalogPage' && colorData.loaded && elements.catalogContainer.children.length === 0) {
                        displayCatalog();
                    }
                });
            });

            // Back to top button
            elements.backToTop.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            window.addEventListener('scroll', () => {
                elements.backToTop.style.display = window.scrollY > 500 ? 'block' : 'none';
            });
        }

        // Set up tab functionality
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    button.classList.add('active');
                    const tabId = button.getAttribute('data-tab') + 'Tab';
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        // Load RAL color data from text files - PRIMARY DATA SOURCE
        async function loadColorData() {
            try {
                elements.loadingIndicator.style.display = 'block';
                elements.catalogLoading.style.display = 'block';
                elements.loadingIndicator.textContent = 'Loading RAL color data from text files...';
                elements.catalogLoading.textContent = 'Loading RAL catalog from text files...';
                
                console.log('Starting to load RAL data from text files...');
                
                // Load English color names
                console.log('Loading English names...');
                const enResponse = await fetch('https://yus.github.io/RAL/ral-design-system-plus-farbnamen-en.txt');
                if (!enResponse.ok) throw new Error(`English names fetch failed: ${enResponse.status}`);
                
                const enText = await enResponse.text();
                const enColors = parseColorData(enText, 'en');
                console.log(`Loaded ${enColors.length} English colors`);
                
                // Load Russian color names
                console.log('Loading Russian names...');
                const ruResponse = await fetch('https://yus.github.io/RAL/ral-design-system-plus-farbnamen-ru.txt');
                if (!ruResponse.ok) throw new Error(`Russian names fetch failed: ${ruResponse.status}`);
                
                const ruText = await ruResponse.text();
                const ruColors = parseColorData(ruText, 'ru');
                console.log(`Loaded ${ruColors.length} Russian colors`);
                
                // Merge the data from both languages
                colorData.ralColors = mergeColorData(enColors, ruColors);
                console.log(`Merged ${colorData.ralColors.length} total colors`);
                
                colorData.loaded = true;
                elements.loadingIndicator.style.display = 'none';
                elements.catalogLoading.style.display = 'none';
                
                console.log(`Final: ${colorData.ralColors.length} RAL colors loaded successfully`);
                
            } catch (error) {
                console.error('Error loading color data:', error);
                elements.loadingIndicator.innerHTML = `Error: ${error.message}. Please check the data sources.`;
                elements.catalogLoading.innerHTML = `Error: ${error.message}. Please check the data sources.`;
                colorData.loaded = false;
            }
        }

        // Parse color data from text files
        function parseColorData(text, language) {
            const colors = [];
            const lines = text.split('\n');
            let parsedCount = 0;
            
            for (const line of lines) {
                if (line.trim() === '') continue;
                
                // Parse RAL code and color name
                const match = line.match(/^(RAL\s+[\d\s-]+)\s+(.+)$/);
                if (match) {
                    const code = match[1].trim().toUpperCase();
                    const name = match[2].trim();
                    
                    if (code && name && name !== 'undefined') {
                        // Generate RGB values from RAL code for visualization
                        const rgb = generateRGBFromRAL(code);
                        
                        colors.push({
                            code: code,
                            name: name,
                            language: language,
                            rgb: rgb,
                            hue: getHueCategory(rgb.r, rgb.g, rgb.b)
                        });
                        parsedCount++;
                    }
                }
            }
            
            console.log(`Parsed ${parsedCount} ${language} colors`);
            return colors;
        }

        // Generate approximate RGB values from RAL code for visualization
        function generateRGBFromRAL(code) {
            // This is a simplified approximation for visualization
            // Real RAL colors would have specific RGB values
            const codeStr = code.replace(/[^\d]/g, '');
            const num = parseInt(codeStr) || 0;
            
            // Create some variety based on the code
            const r = (num * 37) % 256;
            const g = (num * 73) % 256;
            const b = (num * 131) % 256;
            
            return { r, g, b };
        }

        // Merge data from both languages
        function mergeColorData(enColors, ruColors) {
            const mergedMap = new Map();
            
            // Add English colors
            enColors.forEach(color => {
                mergedMap.set(color.code, {
                    code: color.code,
                    nameEn: color.name,
                    nameRu: '',
                    rgb: color.rgb,
                    hue: color.hue
                });
            });
            
            // Add Russian names to existing entries or create new ones
            ruColors.forEach(color => {
                if (mergedMap.has(color.code)) {
                    mergedMap.get(color.code).nameRu = color.name;
                } else {
                    mergedMap.set(color.code, {
                        code: color.code,
                        nameEn: '',
                        nameRu: color.name,
                        rgb: color.rgb,
                        hue: color.hue
                    });
                }
            });
            
            return Array.from(mergedMap.values());
        }

        // Get hue category for filtering
        function getHueCategory(r, g, b) {
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const delta = max - min;
            
            if (delta === 0) return 'neutral';
            
            let hue;
            if (max === r) {
                hue = ((g - b) / delta) % 6;
            } else if (max === g) {
                hue = (b - r) / delta + 2;
            } else {
                hue = (r - g) / delta + 4;
            }
            
            hue = Math.round(hue * 60);
            if (hue < 0) hue += 360;
            
            // Define hue ranges for categories
            if ((hue >= 0 && hue < 15) || (hue >= 345 && hue <= 360)) return 'red';
            if (hue >= 15 && hue < 45) return 'orange';
            if (hue >= 45 && hue < 75) return 'yellow';
            if (hue >= 75 && hue < 165) return 'green';
            if (hue >= 165 && hue < 195) return 'blue';
            if (hue >= 195 && hue < 285) return 'purple';
            if (hue >= 285 && hue < 345) return 'purple';
            return 'neutral';
        }

        // Set up event listeners
        function setupEventListeners() {
            // RGB inputs
            elements.redSlider.addEventListener('input', updateRed);
            elements.redInput.addEventListener('input', updateRed);
            elements.greenSlider.addEventListener('input', updateGreen);
            elements.greenInput.addEventListener('input', updateGreen);
            elements.blueSlider.addEventListener('input', updateBlue);
            elements.blueInput.addEventListener('input', updateBlue);
            elements.hexInput.addEventListener('input', updateFromHex);
            
            // CMYK inputs
            elements.cyanSlider.addEventListener('input', updateCyan);
            elements.cyanInput.addEventListener('input', updateCyan);
            elements.magentaSlider.addEventListener('input', updateMagenta);
            elements.magentaInput.addEventListener('input', updateMagenta);
            elements.yellowSlider.addEventListener('input', updateYellow);
            elements.yellowInput.addEventListener('input', updateYellow);
            elements.blackSlider.addEventListener('input', updateBlack);
            elements.blackInput.addEventListener('input', updateBlack);
            elements.cmykInput.addEventListener('input', updateFromCmyk);
            
            // Settings
            elements.resultsCount.addEventListener('input', updateResultsCount);
            elements.maxDifference.addEventListener('input', updateMaxDifference);
            elements.findMatches.addEventListener('click', findMatchingColors);
            
            // Catalog
            elements.catalogSearch.addEventListener('input', filterCatalog);
            elements.hueButtons.forEach(button => {
                button.addEventListener('click', () => {
                    elements.hueButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    filterCatalog();
                });
            });
        }

        // Update settings
        function updateResultsCount() {
            elements.resultsCountValue.textContent = elements.resultsCount.value;
        }

        function updateMaxDifference() {
            elements.maxDifferenceValue.textContent = elements.maxDifference.value;
        }

        // RGB update functions
        function updateRed() {
            const value = Math.min(255, Math.max(0, parseInt(elements.redSlider.value) || 0));
            elements.redSlider.value = value;
            elements.redInput.value = value;
            updateColorFromRGB();
        }

        function updateGreen() {
            const value = Math.min(255, Math.max(0, parseInt(elements.greenSlider.value) || 0));
            elements.greenSlider.value = value;
            elements.greenInput.value = value;
            updateColorFromRGB();
        }

        function updateBlue() {
            const value = Math.min(255, Math.max(0, parseInt(elements.blueSlider.value) || 0));
            elements.blueSlider.value = value;
            elements.blueInput.value = value;
            updateColorFromRGB();
        }

        // CMYK update functions
        function updateCyan() {
            const value = Math.min(100, Math.max(0, parseInt(elements.cyanSlider.value) || 0));
            elements.cyanSlider.value = value;
            elements.cyanInput.value = value;
            updateColorFromCMYK();
        }

        function updateMagenta() {
            const value = Math.min(100, Math.max(0, parseInt(elements.magentaSlider.value) || 0));
            elements.magentaSlider.value = value;
            elements.magentaInput.value = value;
            updateColorFromCMYK();
        }

        function updateYellow() {
            const value = Math.min(100, Math.max(0, parseInt(elements.yellowSlider.value) || 0));
            elements.yellowSlider.value = value;
            elements.yellowInput.value = value;
            updateColorFromCMYK();
        }

        function updateBlack() {
            const value = Math.min(100, Math.max(0, parseInt(elements.blackSlider.value) || 0));
            elements.blackSlider.value = value;
            elements.blackInput.value = value;
            updateColorFromCMYK();
        }

        // Color conversion and update functions
        function updateColorFromRGB() {
            const r = parseInt(elements.redInput.value);
            const g = parseInt(elements.greenInput.value);
            const b = parseInt(elements.blueInput.value);
            
            const hex = rgbToHex(r, g, b);
            elements.hexInput.value = hex;
            
            const cmyk = rgbToCmyk(r, g, b);
            updateCmykInputs(cmyk);
            
            updateColorPreview();
        }

        function updateColorFromCMYK() {
            const c = parseInt(elements.cyanInput.value) / 100;
            const m = parseInt(elements.magentaInput.value) / 100;
            const y = parseInt(elements.yellowInput.value) / 100;
            const k = parseInt(elements.blackInput.value) / 100;
            
            elements.cmykInput.value = `${Math.round(c*100)},${Math.round(m*100)},${Math.round(y*100)},${Math.round(k*100)}`;
            
            const rgb = cmykToRgb(c, m, y, k);
            updateRgbInputs(rgb);
            
            updateColorPreview();
        }

        function updateFromHex() {
            const hex = elements.hexInput.value.replace('#', '');
            
            if (hex.length === 3 || hex.length === 6) {
                const rgb = hexToRgb(hex);
                if (rgb) {
                    updateRgbInputs(rgb);
                    const cmyk = rgbToCmyk(rgb.r, rgb.g, rgb.b);
                    updateCmykInputs(cmyk);
                    updateColorPreview();
                }
            }
        }

        function updateFromCmyk() {
            const cmykStr = elements.cmykInput.value;
            const parts = cmykStr.split(',').map(part => parseInt(part.trim()));
            
            if (parts.length === 4 && parts.every(p => !isNaN(p) && p >= 0 && p <= 100)) {
                const [c, m, y, k] = parts;
                elements.cyanInput.value = c;
                elements.cyanSlider.value = c;
                elements.magentaInput.value = m;
                elements.magentaSlider.value = m;
                elements.yellowInput.value = y;
                elements.yellowSlider.value = y;
                elements.blackInput.value = k;
                elements.blackSlider.value = k;
                
                updateColorFromCMYK();
            }
        }

        function updateRgbInputs(rgb) {
            elements.redSlider.value = rgb.r;
            elements.redInput.value = rgb.r;
            elements.greenSlider.value = rgb.g;
            elements.greenInput.value = rgb.g;
            elements.blueSlider.value = rgb.b;
            elements.blueInput.value = rgb.b;
            elements.hexInput.value = rgbToHex(rgb.r, rgb.g, rgb.b);
        }

        function updateCmykInputs(cmyk) {
            elements.cyanInput.value = Math.round(cmyk.c * 100);
            elements.cyanSlider.value = Math.round(cmyk.c * 100);
            elements.magentaInput.value = Math.round(cmyk.m * 100);
            elements.magentaSlider.value = Math.round(cmyk.m * 100);
            elements.yellowInput.value = Math.round(cmyk.y * 100);
            elements.yellowSlider.value = Math.round(cmyk.y * 100);
            elements.blackInput.value = Math.round(cmyk.k * 100);
            elements.blackSlider.value = Math.round(cmyk.k * 100);
            elements.cmykInput.value = `${Math.round(cmyk.c * 100)},${Math.round(cmyk.m * 100)},${Math.round(cmyk.y * 100)},${Math.round(cmyk.k * 100)}`;
        }

        function updateColorPreview() {
            const r = parseInt(elements.redInput.value);
            const g = parseInt(elements.greenInput.value);
            const b = parseInt(elements.blueInput.value);
            const cmyk = rgbToCmyk(r, g, b);
            
            elements.colorPreview.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            elements.colorPreview.style.color = brightness > 128 ? 'black' : 'white';
            
            elements.colorPreview.innerHTML = `
                <div class="preview-values">
                    <div class="preview-group">
                        <div class="preview-label">RGB</div>
                        <div>${r}, ${g}, ${b}</div>
                    </div>
                    <div class="preview-group">
                        <div class="preview-label">CMYK</div>
                        <div>${Math.round(cmyk.c * 100)}%, ${Math.round(cmyk.m * 100)}%, ${Math.round(cmyk.y * 100)}%, ${Math.round(cmyk.k * 100)}%</div>
                    </div>
                </div>
            `;
        }

        // Color conversion functions
        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = x.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        function hexToRgb(hex) {
            if (hex.length === 3) hex = hex.split('').map(x => x + x).join('');
            const result = /^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function rgbToCmyk(r, g, b) {
            if (r === 0 && g === 0 && b === 0) return { c: 0, m: 0, y: 0, k: 1 };
            const rPrime = r / 255, gPrime = g / 255, bPrime = b / 255;
            const k = 1 - Math.max(rPrime, gPrime, bPrime);
            return {
                c: (1 - rPrime - k) / (1 - k) || 0,
                m: (1 - gPrime - k) / (1 - k) || 0,
                y: (1 - bPrime - k) / (1 - k) || 0,
                k: k || 0
            };
        }

        function cmykToRgb(c, m, y, k) {
            return {
                r: Math.round(255 * (1 - c) * (1 - k)),
                g: Math.round(255 * (1 - m) * (1 - k)),
                b: Math.round(255 * (1 - y) * (1 - k))
            };
        }

        // Color matching functions
        function colorDifferenceRgb(rgb1, rgb2) {
            const rDiff = rgb1.r - rgb2.r, gDiff = rgb1.g - rgb2.g, bDiff = rgb1.b - rgb2.b;
            return Math.sqrt(rDiff * rDiff + gDiff * gDiff + bDiff * bDiff);
        }

        function findMatchingColors() {
            if (!colorData.loaded) {
                elements.resultsContainer.innerHTML = '<div class="loading">Still loading color data...</div>';
                return;
            }
            
            const inputRgb = {
                r: parseInt(elements.redInput.value),
                g: parseInt(elements.greenInput.value),
                b: parseInt(elements.blueInput.value)
            };
            
            const resultsCount = parseInt(elements.resultsCount.value) || 12;
            const maxDifference = parseInt(elements.maxDifference.value) || 100;
            
            const colorsWithDifferences = colorData.ralColors.map(color => {
                const difference = colorDifferenceRgb(inputRgb, color.rgb);
                
                return {
                    ...color,
                    difference: difference,
                    cmyk: rgbToCmyk(color.rgb.r, color.rgb.g, color.rgb.b)
                };
            }).filter(color => color.difference <= maxDifference);
            
            colorsWithDifferences.sort((a, b) => a.difference - b.difference);
            const topMatches = colorsWithDifferences.slice(0, resultsCount);
            
            displayResults(topMatches);
            
            // Show catalog link for closest match
            if (topMatches.length > 0) {
                elements.viewCatalogLink.style.display = 'inline-block';
                elements.viewCatalogLink.onclick = (e) => {
                    e.preventDefault();
                    highlightAndShowInCatalog(topMatches[0].code);
                };
            } else {
                elements.viewCatalogLink.style.display = 'none';
            }
        }

        function displayResults(matches) {
            elements.resultsContainer.innerHTML = '';
            
            if (matches.length === 0) {
                elements.resultsContainer.innerHTML = '<p>No matching colors found within the specified difference threshold.</p>';
                return;
            }
            
            matches.forEach(match => {
                const colorCard = document.createElement('div');
                colorCard.className = 'color-card';
                colorCard.addEventListener('click', () => {
                    // When clicking a match result, go to catalog and highlight it
                    highlightAndShowInCatalog(match.code);
                });
                
                const colorSwatch = document.createElement('div');
                colorSwatch.className = 'color-swatch';
                colorSwatch.style.backgroundColor = `rgb(${match.rgb.r}, ${match.rgb.g}, ${match.rgb.b})`;
                
                const brightness = (match.rgb.r * 299 + match.rgb.g * 587 + match.rgb.b * 114) / 1000;
                colorSwatch.style.color = brightness > 128 ? 'black' : 'white';
                colorSwatch.innerHTML = `
                    <div>${match.code}</div>
                    <div style="font-size: 0.8rem;">RGB: ${match.rgb.r}, ${match.rgb.g}, ${match.rgb.b}</div>
                `;
                
                const colorInfo = document.createElement('div');
                colorInfo.className = 'color-info';
                
                const colorCode = document.createElement('div');
                colorCode.className = 'color-code';
                colorCode.textContent = match.code;
                
                const colorNameEn = document.createElement('div');
                colorNameEn.className = 'color-name';
                colorNameEn.textContent = match.nameEn || 'No English name';
                if (!match.nameEn) colorNameEn.style.color = '#999';
                
                const colorNameRu = document.createElement('div');
                colorNameRu.className = 'color-name-ru';
                colorNameRu.textContent = match.nameRu || 'No Russian name';
                if (!match.nameRu) colorNameRu.style.color = '#999';
                
                const colorValues = document.createElement('div');
                colorValues.className = 'color-values';
                colorValues.innerHTML = `
                    <div class="value-group">
                        <div class="value-label">RGB</div>
                        <div>${match.rgb.r}, ${match.rgb.g}, ${match.rgb.b}</div>
                    </div>
                    <div class="value-group">
                        <div class="value-label">CMYK</div>
                        <div>${Math.round(match.cmyk.c * 100)}%, ${Math.round(match.cmyk.m * 100)}%, ${Math.round(match.cmyk.y * 100)}%, ${Math.round(match.cmyk.k * 100)}%</div>
                    </div>
                `;
                
                const difference = document.createElement('div');
                difference.className = 'difference';
                if (match.difference < 30) difference.classList.add('difference-low');
                else if (match.difference < 70) difference.classList.add('difference-medium');
                else difference.classList.add('difference-high');
                difference.textContent = `Color difference: ${match.difference.toFixed(2)}`;
                
                colorInfo.appendChild(colorCode);
                colorInfo.appendChild(colorNameEn);
                colorInfo.appendChild(colorNameRu);
                colorInfo.appendChild(colorValues);
                colorInfo.appendChild(difference);
                
                colorCard.appendChild(colorSwatch);
                colorCard.appendChild(colorInfo);
                elements.resultsContainer.appendChild(colorCard);
            });
        }

        // Catalog functions
        function displayCatalog() {
            if (!colorData.loaded || colorData.ralColors.length === 0) {
                console.log('No color data available for catalog');
                elements.catalogContainer.innerHTML = '<div class="loading">No color data available. Please check the data sources.</div>';
                return;
            }
            
            const hueCategories = {
                red: [], orange: [], yellow: [], green: [], blue: [], purple: [], neutral: []
            };
            
            // Sort colors by hue category
            colorData.ralColors.forEach(color => {
                if (hueCategories[color.hue]) {
                    hueCategories[color.hue].push(color);
                } else {
                    hueCategories.neutral.push(color);
                }
            });
            
            // Sort each category by RAL code for consistent ordering
            Object.keys(hueCategories).forEach(hue => {
                hueCategories[hue].sort((a, b) => a.code.localeCompare(b.code));
            });
            
            elements.catalogContainer.innerHTML = '';
            
            // Display each category
            const categoryOrder = ['red', 'orange', 'yellow', 'green', 'blue', 'purple', 'neutral'];
            let totalColors = 0;
            
            categoryOrder.forEach(hue => {
                if (hueCategories[hue].length === 0) return;
                
                totalColors += hueCategories[hue].length;
                const section = document.createElement('div');
                section.id = `section-${hue}`;
                
                const header = document.createElement('div');
                header.className = 'section-header';
                header.textContent = `${hue.charAt(0).toUpperCase() + hue.slice(1)} Colors (${hueCategories[hue].length})`;
                section.appendChild(header);
                
                const grid = document.createElement('div');
                grid.className = 'catalog-grid';
                
                hueCategories[hue].forEach(color => {
                    const card = createCatalogCard(color);
                    grid.appendChild(card);
                });
                
                section.appendChild(grid);
                elements.catalogContainer.appendChild(section);
            });
            
            console.log(`Catalog displayed with ${totalColors} colors across ${categoryOrder.filter(hue => hueCategories[hue].length > 0).length} categories`);
            
            // Re-apply highlight if needed
            if (colorData.currentHighlight) {
                setTimeout(() => highlightColorInCatalog(colorData.currentHighlight), 100);
            }
        }

        function createCatalogCard(color) {
            const card = document.createElement('div');
            card.className = 'catalog-card';
            card.id = `color-${color.code.replace(/\s+/g, '-')}`;
            card.addEventListener('click', () => {
                // When clicking a catalog card, go back to matcher and set it as input
                setColorAsInput(color);
            });
            
            const swatch = document.createElement('div');
            swatch.className = 'catalog-swatch';
            swatch.style.backgroundColor = `rgb(${color.rgb.r}, ${color.rgb.g}, ${color.rgb.b})`;
            
            const brightness = (color.rgb.r * 299 + color.rgb.g * 587 + color.rgb.b * 114) / 1000;
            swatch.style.color = brightness > 128 ? 'black' : 'white';
            swatch.textContent = color.code;
            
            const info = document.createElement('div');
            info.className = 'catalog-info';
            
            const code = document.createElement('div');
            code.className = 'catalog-code';
            code.textContent = color.code;
            
            const nameEn = document.createElement('div');
            nameEn.className = 'catalog-name';
            nameEn.textContent = color.nameEn || 'No English name';
            
            const nameRu = document.createElement('div');
            nameRu.className = 'catalog-name-ru';
            nameRu.textContent = color.nameRu || 'No Russian name';
            
            info.appendChild(code);
            info.appendChild(nameEn);
            info.appendChild(nameRu);
            card.appendChild(swatch);
            card.appendChild(info);
            
            return card;
        }

        function filterCatalog() {
            const searchTerm = elements.catalogSearch.value.toLowerCase();
            const activeHue = document.querySelector('.hue-button.active').getAttribute('data-hue');
            
            document.querySelectorAll('.catalog-card').forEach(card => {
                const code = card.querySelector('.catalog-code').textContent.toLowerCase();
                const nameEn = card.querySelector('.catalog-name').textContent.toLowerCase();
                const nameRu = card.querySelector('.catalog-name-ru').textContent.toLowerCase();
                const section = card.closest('[id^="section-"]');
                const hue = section ? section.id.replace('section-', '') : '';
                
                const matchesSearch = !searchTerm || 
                    code.includes(searchTerm) || 
                    nameEn.includes(searchTerm) || 
                    nameRu.includes(searchTerm);
                const matchesHue = activeHue === 'all' || hue === activeHue;
                
                card.style.display = matchesSearch && matchesHue ? 'block' : 'none';
            });
            
            // Hide empty sections
            document.querySelectorAll('.section-header').forEach(header => {
                const section = header.nextElementSibling;
                const visibleCards = section.querySelectorAll('.catalog-card[style=""]').length + 
                                   section.querySelectorAll('.catalog-card:not([style])').length;
                header.style.display = visibleCards > 0 ? 'block' : 'none';
                section.style.display = visibleCards > 0 ? 'grid' : 'none';
            });
        }

        function highlightAndShowInCatalog(colorCode) {
            // Switch to catalog page
            elements.navTabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector('.nav-tab[data-page="catalog"]').classList.add('active');
            elements.pages.forEach(page => page.classList.remove('active'));
            elements.catalogPage.classList.add('active');
            
            // Ensure catalog is loaded
            if (elements.catalogContainer.children.length === 0) {
                displayCatalog();
            }
            
            // Highlight the color
            setTimeout(() => {
                highlightColorInCatalog(colorCode);
            }, 100);
        }

        function highlightColorInCatalog(colorCode) {
            // Remove previous highlight
            document.querySelectorAll('.catalog-card.highlighted').forEach(card => {
                card.classList.remove('highlighted');
            });
            
            // Add new highlight
            const cardId = `color-${colorCode.replace(/\s+/g, '-')}`;
            const card = document.getElementById(cardId);
            
            if (card) {
                card.classList.add('highlighted');
                colorData.currentHighlight = colorCode;
                
                // Scroll to the card
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function setColorAsInput(color) {
            // Switch to matcher page
            elements.navTabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector('.nav-tab[data-page="matcher"]').classList.add('active');
            elements.pages.forEach(page => page.classList.remove('active'));
            elements.matcherPage.classList.add('active');
            
            // Set the color as input values
            updateRgbInputs(color.rgb);
            updateColorPreview();
            
            // Find matching colors for this new input
            findMatchingColors();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
