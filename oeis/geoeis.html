<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OEIS Sequence Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #0d1117;
            color: #e6edf3;
            line-height: 1.4;
            padding: 0;
        }
        
        .container {
            max-width: 100%;
            padding: 0;
        }
        
        /* Header */
        .header {
            background: #161b22;
            border-bottom: 1px solid #30363d;
            padding: 16px;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 1280px;
            margin: 0 auto;
        }
        
        .logo {
            font-weight: 600;
            font-size: 16px;
            color: #f0f6fc;
        }
        
        /* Help Section */
        .help-section {
            background: #0d1117;
            border-bottom: 1px solid #30363d;
            padding: 16px;
        }
        
        .help-toggle {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 12px 16px;
            color: #7d8590;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }
        
        .help-toggle:hover {
            background: #1f2937;
        }
        
        .help-content {
            display: none;
            margin-top: 12px;
            padding: 16px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
        }
        
        .help-content.show {
            display: block;
        }
        
        .help-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .help-category {
            background: #0d1117;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #30363d;
        }
        
        .help-category h4 {
            color: #2f81f7;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .help-examples {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            color: #7d8590;
        }
        
        .help-examples div {
            margin-bottom: 4px;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 2px;
        }
        
        .help-examples div:hover {
            background: #1f2937;
            color: #e6edf3;
        }
        
        /* Canvas Section */
        .canvas-section {
            background: #0d1117;
            border-bottom: 1px solid #30363d;
        }
        
        #mainCanvas {
            width: 100%;
            height: 270px;
            display: block;
        }
        
        /* Input Section */
        .input-section {
            background: #0d1117;
            padding: 16px;
            border-bottom: 1px solid #30363d;
        }
        
        .input-group {
            display: flex;
            max-width: 1280px;
            margin: 0 auto;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 8px 12px;
            background: #010409;
            border: 1px solid #30363d;
            border-radius: 6px 0 0 6px;
            color: #e6edf3;
            font-family: inherit;
            font-size: 14px;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #1f6feb;
            box-shadow: 0 0 0 2px #1f6feb40;
        }
        
        button {
            padding: 8px 16px;
            background: #238636;
            border: 1px solid #2ea043;
            border-radius: 0 6px 6px 0;
            color: white;
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
        }
        
        button:hover {
            background: #2ea043;
        }
        
        button:disabled {
            background: #30363d;
            border-color: #484f58;
            cursor: not-allowed;
        }
        
        /* Loading */
        .loading {
            display: none;
            align-items: center;
            gap: 8px;
            color: #7d8590;
            font-size: 14px;
            margin-top: 8px;
        }
        
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #30363d;
            border-top: 2px solid #1f6feb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Info Section */
        .info-section {
            background: #0d1117;
            padding: 16px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            max-width: 1280px;
            margin: 0 auto;
        }
        
        .sequence-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 16px;
        }
        
        .sequence-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .sequence-id {
            font-weight: 600;
            color: #2f81f7;
            font-size: 14px;
        }
        
        .sequence-badge {
            background: #1f6feb;
            color: white;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .similarity-badge {
            background: #8957e5;
            color: white;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .function-type-badge {
            background: #db6d28;
            color: white;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .sequence-description {
            color: #7d8590;
            font-size: 13px;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .sequence-formula {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 4px;
            padding: 8px 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            color: #e6edf3;
            margin-bottom: 12px;
        }
        
        .sequence-explanation {
            color: #7d8590;
            font-size: 12px;
            font-style: italic;
            margin-bottom: 8px;
            padding: 8px;
            background: #0d1117;
            border-radius: 4px;
            border-left: 2px solid #30363d;
        }
        
        .sequence-link {
            color: #2f81f7;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .sequence-link:hover {
            text-decoration: underline;
        }
        
        /* Footer */
        footer {
            background: #0d1117;
            border-top: 1px solid #30363d;
            padding: 16px;
            text-align: center;
            font-size: 12px;
            color: #7d8590;
        }
        
        .footer-content {
            max-width: 1280px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .footer-links {
            display: flex;
            gap: 16px;
        }
        
        .footer-link {
            color: #7d8590;
            text-decoration: none;
            font-size: 12px;
        }
        
        .footer-link:hover {
            color: #2f81f7;
        }
        
        /* Mobile optimization */
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 8px;
            }
            
            .help-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">OEIS Sequence Visualizer</div>
            </div>
        </header>
        
        <!-- Help Section -->
        <section class="help-section">
            <div class="help-toggle" onclick="toggleHelp()">
                <span>ðŸ“š Math Input Help & Examples</span>
                <span id="helpArrow">â–¼</span>
            </div>
            <div class="help-content" id="helpContent">
                <div class="help-grid">
                    <div class="help-category">
                        <h4>Basic Arithmetic</h4>
                        <div class="help-examples">
                            <div onclick="setExample('n')">n (natural numbers)</div>
                            <div onclick="setExample('n^2')">n^2 (squares)</div>
                            <div onclick="setExample('n*(n+1)/2')">n*(n+1)/2 (triangular)</div>
                            <div onclick="setExample('2*n+1')">2*n+1 (odd numbers)</div>
                        </div>
                    </div>
                    <div class="help-category">
                        <h4>Exponential & Powers</h4>
                        <div class="help-examples">
                            <div onclick="setExample('2^n')">2^n (powers of 2)</div>
                            <div onclick="setExample('3^n')">3^n (powers of 3)</div>
                            <div onclick="setExample('n^3')">n^3 (cubes)</div>
                            <div onclick="setExample('2^(n-1)')">2^(n-1)</div>
                        </div>
                    </div>
                    <div class="help-category">
                        <h4>Logarithmic</h4>
                        <div class="help-examples">
                            <div onclick="setExample('log(2)/n')">log(2)/n</div>
                            <div onclick="setExample('log(70280^(1/n))')">log(70280^(1/n))</div>
                            <div onclick="setExample('log(n+1)')">log(n+1)</div>
                        </div>
                    </div>
                    <div class="help-category">
                        <h4>Trigonometric</h4>
                        <div class="help-examples">
                            <div onclick="setExample('sin(n)')">sin(n)</div>
                            <div onclick="setExample('cos(n*PI/4)')">cos(n*PI/4)</div>
                            <div onclick="setExample('tan(n/2)')">tan(n/2)</div>
                        </div>
                    </div>
                </div>
                <div style="font-size: 12px; color: #7d8590;">
                    <strong>Available constants:</strong> PI, E<br>
                    <strong>Available functions:</strong> sin, cos, tan, log, exp, sqrt, abs<br>
                    <strong>Use 'n' as the sequence variable</strong>
                </div>
            </div>
        </section>
        
        <!-- Canvas Section -->
        <section class="canvas-section">
            <div id="mainCanvas"></div>
        </section>
        
        <!-- Input Section -->
        <section class="input-section">
            <div class="input-group">
                <input type="text" id="functionInput" placeholder="log(70280^(1/n))" value="log(70280^(1/n))">
                <button id="searchButton" onclick="searchOEIS()">Search</button>
            </div>
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <span>Searching OEIS database...</span>
            </div>
        </section>
        
        <!-- Info Section -->
        <section class="info-section">
            <div id="infoGrid" class="info-grid">
                <!-- Dynamic content will be inserted here -->
            </div>
        </section>
        
        <footer>
            <div class="footer-content">
                <div>OEIS Sequence Visualizer</div>
                <div class="footer-links">
                    <a href="https://github.com" class="footer-link">GitHub</a>
                    <a href="https://oeis.org" class="footer-link">OEIS</a>
                    <a href="#" class="footer-link">Docs</a>
                </div>
            </div>
        </footer>
    </div>

    <script>
        let mainCanvas;
        let sequenceData = [];
        let oeisSequences = [];
        let currentFunctionType = '';
        
        // Enhanced OEIS sequence database with function types and explanations
        const oeisDatabase = {
            logarithmic: {
                name: "Logarithmic Sequences",
                description: "Sequences involving logarithmic growth or decay patterns",
                color: [70, 130, 180], // Steel blue
                sequences: [
                    {
                        number: 'A002162',
                        name: 'Decimal expansion of the natural logarithm of 2.',
                        data: '0,6,9,3,1,4,7,1,8,0,5,5,9,9,4,5,3,0,9,4,1,7,2,3,2,1,2,0,9,8,6,2,3,7,3,6,2,1,8,7,5,4,2,3,8,9,0,4,5,2',
                        formula: 'log(2)',
                        explanation: 'The natural logarithm of 2 appears in many mathematical contexts including compound interest and information theory.'
                    },
                    {
                        number: 'A016738',
                        name: 'Continued fraction for log(50).',
                        data: '3,1,1,8,1,1,2,1,1,1,2,1,2,1,4,1,1,1,1,3,2,8,1,2,2,1,7,1,1,2,1,1,1,3,5,1,1,1,1,2,1,1,1,1,1,1,1,2,3,2',
                        formula: 'log(50)',
                        explanation: 'Logarithmic constants often have interesting continued fraction expansions.'
                    }
                ]
            },
            polynomial: {
                name: "Polynomial Sequences", 
                description: "Sequences following polynomial growth patterns",
                color: [50, 205, 50], // Lime green
                sequences: [
                    {
                        number: 'A000027',
                        name: 'The positive integers.',
                        data: '1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20',
                        formula: 'n',
                        explanation: 'The most fundamental sequence in mathematics - the natural numbers.'
                    },
                    {
                        number: 'A000290',
                        name: 'The squares.',
                        data: '0,1,4,9,16,25,36,49,64,81,100,121,144,169,196,225,256,289,324,361',
                        formula: 'n^2',
                        explanation: 'Perfect squares grow quadratically, forming the basis for many geometric patterns.'
                    },
                    {
                        number: 'A000217',
                        name: 'Triangular numbers.',
                        data: '0,1,3,6,10,15,21,28,36,45,55,66,78,91,105,120,136,153,171,190',
                        formula: 'n(n+1)/2',
                        explanation: 'Triangular numbers represent the number of objects in an equilateral triangle.'
                    }
                ]
            },
            exponential: {
                name: "Exponential Sequences",
                description: "Sequences with exponential growth or decay",
                color: [255, 140, 0], // Dark orange
                sequences: [
                    {
                        number: 'A000079',
                        name: 'Powers of 2.',
                        data: '1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288',
                        formula: '2^n',
                        explanation: 'Powers of 2 are fundamental in computer science and combinatorics.'
                    },
                    {
                        number: 'A000244',
                        name: 'Powers of 3.',
                        data: '1,3,9,27,81,243,729,2187,6561,19683,59049,177147,531441,1594323,4782969,14348907,43046721,129140163,387420489,1162261467',
                        formula: '3^n',
                        explanation: 'Powers of 3 appear in many mathematical contexts including fractal geometry.'
                    }
                ]
            },
            trigonometric: {
                name: "Trigonometric Sequences",
                description: "Sequences involving trigonometric functions",
                color: [148, 0, 211], // Dark violet
                sequences: [
                    {
                        number: 'A010050',
                        name: 'Factorial numbers.',
                        data: '1,1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600,6227020800,87178291200,1307674368000,20922789888000,355687428096000,6402373705728000,121645100408832000',
                        formula: 'n!',
                        explanation: 'Factorials grow faster than exponential functions and appear in combinatorics.'
                    },
                    {
                        number: 'A000045',
                        name: 'Fibonacci numbers.',
                        data: '0,1,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1597,2584,4181',
                        formula: 'F(n) = F(n-1) + F(n-2)',
                        explanation: 'The Fibonacci sequence appears in nature, art, and many mathematical contexts.'
                    }
                ]
            },
            rational: {
                name: "Rational Sequences",
                description: "Sequences involving rational functions",
                color: [220, 20, 60], // Crimson
                sequences: [
                    {
                        number: 'A001477',
                        name: 'The nonnegative integers.',
                        data: '0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19',
                        formula: 'n',
                        explanation: 'The simplest integer sequence starting from zero.'
                    },
                    {
                        number: 'A000012',
                        name: 'The simplest sequence of positive numbers.',
                        data: '1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1',
                        formula: '1',
                        explanation: 'The constant sequence - every term is 1.'
                    }
                ]
            }
        };

        function setup() {
            const canvasWidth = windowWidth;
            const canvasHeight = 270;
            mainCanvas = createCanvas(canvasWidth, canvasHeight);
            mainCanvas.parent('mainCanvas');
            
            // Load initial data immediately
            setTimeout(() => {
                searchOEIS();
            }, 100);
            
            window.addEventListener('resize', function() {
                resizeCanvas(windowWidth, 270);
                updateVisualization();
            });
        }
        
        function toggleHelp() {
            const helpContent = document.getElementById('helpContent');
            const helpArrow = document.getElementById('helpArrow');
            
            helpContent.classList.toggle('show');
            helpArrow.textContent = helpContent.classList.contains('show') ? 'â–²' : 'â–¼';
        }
        
        function setExample(example) {
            document.getElementById('functionInput').value = example;
            searchOEIS();
            toggleHelp(); // Close help after selection
        }
        
        async function searchOEIS() {
            const input = document.getElementById('functionInput').value;
            const button = document.getElementById('searchButton');
            const loading = document.getElementById('loading');
            
            // Show loading state
            button.disabled = true;
            loading.style.display = 'flex';
            
            try {
                // Generate sequence from function
                const compiled = math.compile(input);
                sequenceData = [];
                
                for (let n = 1; n <= 20; n++) {
                    try {
                        const scope = { n: n, PI: Math.PI, E: Math.E };
                        const value = compiled.evaluate(scope);
                        // Store both raw and normalized values for comparison
                        sequenceData.push({
                            raw: value,
                            normalized: value
                        });
                    } catch (e) {
                        sequenceData.push({ raw: 0, normalized: 0 });
                    }
                }
                
                // Normalize the sequence for better comparison
                normalizeSequence();
                
                // Find similar sequences
                findSimilarSequences();
                
                // Update visualization
                updateVisualization();
                
            } catch (error) {
                console.error('Search error:', error);
                showError('Failed to process function: ' + error.message);
            } finally {
                button.disabled = false;
                loading.style.display = 'none';
            }
        }
        
        function normalizeSequence() {
            if (sequenceData.length === 0) return;
            
            // Get raw values
            const rawValues = sequenceData.map(item => item.raw);
            const minVal = Math.min(...rawValues);
            const maxVal = Math.max(...rawValues);
            const range = maxVal - minVal;
            
            // Normalize to [0, 1] range
            if (range !== 0) {
                sequenceData.forEach((item, index) => {
                    item.normalized = (rawValues[index] - minVal) / range;
                });
            }
        }
        
        function detectFunctionType(input) {
            const lowerInput = input.toLowerCase();
            
            if (lowerInput.includes('log')) return 'logarithmic';
            if (lowerInput.includes('^') || lowerInput.includes('**') || lowerInput.includes('exp')) return 'exponential';
            if (lowerInput.includes('sin') || lowerInput.includes('cos') || lowerInput.includes('tan')) return 'trigonometric';
            if (lowerInput.includes('/') || lowerInput.includes('1/')) return 'rational';
            return 'polynomial';
        }
        
        function findSimilarSequences() {
            const inputFunction = document.getElementById('functionInput').value;
            currentFunctionType = detectFunctionType(inputFunction);
            
            let allSequences = [];
            
            // Get sequences from the detected type first, then others
            if (oeisDatabase[currentFunctionType]) {
                allSequences = [...oeisDatabase[currentFunctionType].sequences];
            }
            
            // Add sequences from other categories
            Object.keys(oeisDatabase).forEach(type => {
                if (type !== currentFunctionType) {
                    allSequences = [...allSequences, ...oeisDatabase[type].sequences.slice(0, 1)];
                }
            });
            
            // Calculate similarity scores for each sequence
            const sequencesWithScores = allSequences.map(seq => {
                const seqValues = seq.data.split(',').slice(0, 20).map(Number);
                const normalizedSeq = normalizeSequenceValues(seqValues);
                const similarity = calculateSimilarity(sequenceData.map(item => item.normalized), normalizedSeq);
                
                return {
                    ...seq,
                    similarity: similarity,
                    normalizedValues: normalizedSeq,
                    type: Object.keys(oeisDatabase).find(type => 
                        oeisDatabase[type].sequences.some(s => s.number === seq.number)
                    )
                };
            });
            
            // Sort by similarity (highest first) and take top 3
            sequencesWithScores.sort((a, b) => b.similarity - a.similarity);
            oeisSequences = sequencesWithScores.slice(0, 3);
            
            updateSequenceCards();
        }
        
        function normalizeSequenceValues(values) {
            const minVal = Math.min(...values);
            const maxVal = Math.max(...values);
            const range = maxVal - minVal;
            
            if (range === 0) return values.map(() => 0.5);
            
            return values.map(val => (val - minVal) / range);
        }
        
        function calculateSimilarity(seq1, seq2) {
            // Ensure sequences have the same length
            const length = Math.min(seq1.length, seq2.length);
            let sumSquaredDiff = 0;
            
            for (let i = 0; i < length; i++) {
                const diff = seq1[i] - seq2[i];
                sumSquaredDiff += diff * diff;
            }
            
            // Convert to similarity score (0 to 1, where 1 is perfect match)
            const rmsd = Math.sqrt(sumSquaredDiff / length);
            return Math.max(0, 1 - rmsd);
        }
        
        function updateSequenceCards() {
            const infoGrid = document.getElementById('infoGrid');
            infoGrid.innerHTML = '';
            
            // Add function type detection info
            const typeInfo = document.createElement('div');
            typeInfo.className = 'sequence-card';
            typeInfo.innerHTML = `
                <div class="sequence-header">
                    <div class="sequence-id">Function Analysis</div>
                    <div class="function-type-badge">${currentFunctionType}</div>
                </div>
                <div class="sequence-description">
                    Your function appears to be <strong>${currentFunctionType}</strong>.
                    ${oeisDatabase[currentFunctionType]?.description || 'This type of function shows characteristic growth patterns.'}
                </div>
                <div class="sequence-explanation">
                    We're comparing your sequence with similar mathematical patterns from the OEIS database.
                    Higher similarity scores indicate closer matches to known sequences.
                </div>
            `;
            infoGrid.appendChild(typeInfo);
            
            // Add sequence cards
            oeisSequences.forEach(seq => {
                const sequenceValues = seq.data.split(',').slice(0, 20).map(Number);
                const similarityPercent = Math.round(seq.similarity * 100);
                const typeColor = oeisDatabase[seq.type]?.color || [100, 100, 100];
                
                const card = document.createElement('div');
                card.className = 'sequence-card';
                card.innerHTML = `
                    <div class="sequence-header">
                        <div class="sequence-id">${seq.number}</div>
                        <div class="sequence-badge">${seq.type}</div>
                        <div class="similarity-badge">${similarityPercent}% match</div>
                    </div>
                    <div class="sequence-description">${seq.name}</div>
                    <div class="sequence-formula">${seq.formula}</div>
                    <div class="sequence-explanation">${seq.explanation}</div>
                    <div class="sequence-data" style="font-size: 11px; color: #7d8590; margin-bottom: 8px;">
                        First terms: [${sequenceValues.slice(0, 6).join(', ')}...]
                    </div>
                    <a href="https://oeis.org/${seq.number}" target="_blank" class="sequence-link">
                        View on OEIS
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M10.5 2.5h-5A1.5 1.5 0 0 0 4 4v8a1.5 1.5 0 0 0 1.5 1.5h5A1.5 1.5 0 0 0 12 12V4a1.5 1.5 0 0 0-1.5-1.5zM11 12a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 12V4a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v8z"/>
                            <path d="M7.5 5.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1 0-1zm0 2h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1 0-1zm0 2h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1 0-1z"/>
                        </svg>
                    </a>
                `;
                infoGrid.appendChild(card);
            });
        }
        
        function updateVisualization() {
            drawCanvas();
        }
        
        function drawCanvas() {
            background(13, 17, 23);
            
            const mainSectionHeight = height * 0.8;
            const previewSectionHeight = height * 0.2;
            const previewWidth = width / 3;
            
            drawMainSection(mainSectionHeight);
            
            // Draw preview sections for OEIS sequences
            if (oeisSequences.length > 0) {
                drawPreviewSection(mainSectionHeight, previewSectionHeight, previewWidth);
            }
        }
        
        function drawMainSection(sectionHeight) {
            push();
            
            if (sequenceData.length === 0) return;
            
            drawGrid(width, sectionHeight, 20);
            
            const rawValues = sequenceData.map(item => item.raw);
            let minVal = Math.min(...rawValues);
            let maxVal = Math.max(...rawValues);
            let range = maxVal - minVal;
            if (range === 0) range = 1;
            
            drawAxes(width, sectionHeight);
            
            // Get color for current function type
            const typeColor = oeisDatabase[currentFunctionType]?.color || [47, 129, 247];
            
            // Draw user's function
            stroke(typeColor[0], typeColor[1], typeColor[2]);
            strokeWeight(2);
            noFill();
            
            beginShape();
            for (let i = 0; i < sequenceData.length; i++) {
                let x = map(i, 0, sequenceData.length - 1, 40, width - 40);
                let y = map(sequenceData[i].raw, minVal, maxVal, sectionHeight - 30, 30);
                vertex(x, y);
                
                if (i % 2 === 0) {
                    fill(13, 17, 23);
                    stroke(typeColor[0], typeColor[1], typeColor[2]);
                    ellipse(x, y, 5, 5);
                    noFill();
                }
            }
            endShape();
            
            fill(230, 237, 243);
            noStroke();
            textSize(11);
            textAlign(LEFT, TOP);
            text("Your " + currentFunctionType + " function: " + document.getElementById('functionInput').value, 45, 25);
            
            pop();
        }
        
        function drawPreviewSection(sectionTop, sectionHeight, previewWidth) {
            for (let i = 0; i < Math.min(3, oeisSequences.length); i++) {
                const seq = oeisSequences[i];
                const sequenceValues = seq.data.split(',').slice(0, 15).map(Number);
                const typeColor = oeisDatabase[seq.type]?.color || [100, 100, 100];
                
                push();
                translate(i * previewWidth, sectionTop);
                
                drawGrid(previewWidth, sectionHeight, 10);
                drawAxes(previewWidth, sectionHeight);
                
                let minVal = Math.min(...sequenceValues);
                let maxVal = Math.max(...sequenceValues);
                let range = maxVal - minVal;
                if (range === 0) range = 1;
                
                // Color based on type
                const r = typeColor[0];
                const g = typeColor[1];
                const b = typeColor[2];
                
                stroke(r, g, b);
                strokeWeight(1.5);
                noFill();
                
                beginShape();
                for (let j = 0; j < sequenceValues.length; j++) {
                    let x = map(j, 0, sequenceValues.length - 1, 15, previewWidth - 15);
                    let y = map(sequenceValues[j], minVal, maxVal, sectionHeight - 12, 12);
                    vertex(x, y);
                    
                    if (j % 2 === 0) {
                        fill(13, 17, 23);
                        stroke(r, g, b);
                        ellipse(x, y, 3, 3);
                        noFill();
                    }
                }
                endShape();
                
                fill(230, 237, 243);
                noStroke();
                textSize(9);
                textAlign(LEFT, TOP);
                text(seq.number + ` (${Math.round(seq.similarity * 100)}%)`, 18, 10);
                
                pop();
            }
        }
        
        function drawGrid(gridWidth, gridHeight, spacing) {
            stroke(48, 54, 61);
            strokeWeight(0.5);
            
            for (let x = 0; x <= gridWidth; x += spacing) {
                drawingContext.setLineDash([1, 3]);
                line(x, 0, x, gridHeight);
            }
            
            for (let y = 0; y <= gridHeight; y += spacing) {
                drawingContext.setLineDash([1, 3]);
                line(0, y, gridWidth, y);
            }
            
            drawingContext.setLineDash([]);
        }
        
        function drawAxes(axesWidth, axesHeight) {
            stroke(139, 148, 158);
            strokeWeight(1);
            
            line(0, axesHeight/2, axesWidth, axesHeight/2);
            line(axesWidth/2, 0, axesWidth/2, axesHeight);
        }
        
        function showError(message) {
            const infoGrid = document.getElementById('infoGrid');
            infoGrid.innerHTML = `
                <div class="sequence-card">
                    <div class="sequence-description" style="color: #f85149;">${message}</div>
                </div>
            `;
        }
        
        // Initialize
        document.getElementById('functionInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchOEIS();
            }
        });
    </script>
</body>
</html>
