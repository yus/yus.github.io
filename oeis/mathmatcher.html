<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OEIS Sequence Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #0a192f;
            color: #e6f1ff;
            font-family: 'Courier New', monospace;
        }
        #container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .input-section {
            margin-bottom: 20px;
        }
        input[type="text"] {
            width: 300px;
            padding: 10px;
            background: #112240;
            border: 1px solid #64ffda;
            color: #e6f1ff;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        button {
            padding: 10px 20px;
            background: #0a192f;
            border: 1px solid #64ffda;
            color: #64ffda;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            margin-left: 10px;
        }
        button:hover {
            background: #112240;
        }
        .sequence-previews {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .preview-container {
            background: #112240;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #233554;
            min-width: 250px;
        }
        .preview-title {
            color: #64ffda;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .preview-canvas {
            border: 1px solid #233554;
        }
        .info-panel {
            background: #112240;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #233554;
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="input-section">
            <h2>OEIS Sequence Visualizer</h2>
            <input type="text" id="functionInput" placeholder="Enter function (e.g., log(70280^(1/n)))" value="log(70280^(1/n))">
            <button onclick="updateVisualization()">Visualize</button>
        </div>
        
        <div id="mainCanvas"></div>
        
        <div class="info-panel" id="infoPanel">
            Enter a function and click "Visualize" to find OEIS sequences
        </div>
        
        <div class="sequence-previews" id="sequencePreviews">
            <!-- Preview canvases will be inserted here -->
        </div>
    </div>

    <script>
        let mainCanvas;
        let sequenceData = [];
        let userFunction = '';
        
        function setup() {
            mainCanvas = createCanvas(800, 400);
            mainCanvas.parent('mainCanvas');
            updateVisualization();
        }
        
        function updateVisualization() {
            const input = document.getElementById('functionInput').value;
            userFunction = input;
            
            try {
                // Parse and evaluate the function
                const compiled = math.compile(input);
                sequenceData = [];
                
                // Generate sequence values for n=1 to 50
                for (let n = 1; n <= 50; n++) {
                    try {
                        const scope = { n: n };
                        const value = compiled.evaluate(scope);
                        sequenceData.push(value);
                    } catch (e) {
                        sequenceData.push(0);
                    }
                }
                
                // Find OEIS sequences (mock implementation - in real app, you'd call an API)
                findOEISSequences(sequenceData);
                drawMainGraph();
                
            } catch (error) {
                document.getElementById('infoPanel').innerHTML = 
                    'Error parsing function: ' + error.message;
            }
        }
        
        function drawMainGraph() {
            background(10, 25, 47); // Dark navy
            
            if (sequenceData.length === 0) return;
            
            // Draw axes
            stroke(100, 150, 255); // Azure
            strokeWeight(1);
            line(50, height - 50, width - 50, height - 50); // x-axis
            line(50, 50, 50, height - 50); // y-axis
            
            // Draw grid
            stroke(30, 60, 90);
            strokeWeight(0.5);
            for (let i = 0; i <= 10; i++) {
                let x = map(i, 0, 10, 50, width - 50);
                line(x, 50, x, height - 50);
                let y = map(i, 0, 10, height - 50, 50);
                line(50, y, width - 50, y);
            }
            
            // Find data range for scaling
            let minVal = Math.min(...sequenceData);
            let maxVal = Math.max(...sequenceData);
            if (minVal === maxVal) {
                minVal -= 1;
                maxVal += 1;
            }
            
            // Draw the sequence
            stroke(100, 255, 218); // Teal
            strokeWeight(2);
            noFill();
            
            beginShape();
            for (let i = 0; i < sequenceData.length; i++) {
                let x = map(i, 0, sequenceData.length - 1, 50, width - 50);
                let y = map(sequenceData[i], minVal, maxVal, height - 50, 50);
                vertex(x, y);
                
                // Draw points for first few terms
                if (i < 10) {
                    fill(100, 255, 218);
                    ellipse(x, y, 6, 6);
                    noFill();
                }
            }
            endShape();
            
            // Labels
            fill(230, 241, 255);
            noStroke();
            textSize(12);
            text('n', width - 30, height - 30);
            text(userFunction, 60, 30);
            
            // Show first few values
            textSize(10);
            for (let i = 0; i < Math.min(5, sequenceData.length); i++) {
                text(`a(${i+1}) = ${sequenceData[i].toFixed(4)}`, 60, 50 + i * 20);
            }
        }
        
        function findOEISSequences(data) {
            // Mock OEIS sequences - in a real implementation, you'd call the OEIS API
            const mockSequences = [
                {
                    id: "A002162",
                    name: "Decimal expansion of the natural logarithm of 2",
                    formula: "log(2)",
                    values: [0.6931, 0.3466, 0.2310, 0.1733, 0.1386]
                },
                {
                    id: "A016738",
                    name: "Continued fraction for log(50)",
                    formula: "log(50)/n",
                    values: [3.9120, 1.9560, 1.3040, 0.9780, 0.7824]
                },
                {
                    id: "A000027",
                    name: "The positive integers",
                    formula: "n",
                    values: [1, 2, 3, 4, 5]
                }
            ];
            
            // Update info panel
            document.getElementById('infoPanel').innerHTML = `
                <strong>Function:</strong> ${userFunction}<br>
                <strong>First 5 terms:</strong> [${data.slice(0, 5).map(v => v.toFixed(4)).join(', ')}]<br>
                <strong>Found ${mockSequences.length} related OEIS sequences</strong>
            `;
            
            // Create preview canvases
            const previewContainer = document.getElementById('sequencePreviews');
            previewContainer.innerHTML = '';
            
            mockSequences.forEach((seq, index) => {
                const container = document.createElement('div');
                container.className = 'preview-container';
                container.innerHTML = `
                    <div class="preview-title">
                        <strong>${seq.id}</strong>: ${seq.name}<br>
                        <em>${seq.formula}</em>
                    </div>
                    <div id="preview${index}"></div>
                    <div style="font-size: 10px; margin-top: 5px;">
                        Values: [${seq.values.join(', ')}]
                    </div>
                `;
                previewContainer.appendChild(container);
                
                // Create preview canvas
                createPreviewCanvas(index, seq.values, `preview${index}`);
            });
        }
        
        function createPreviewCanvas(index, values, parentId) {
            const preview = createCanvas(200, 100);
            preview.parent(parentId);
            
            background(17, 34, 64);
            
            // Draw mini graph
            stroke(100, 255, 218);
            strokeWeight(1);
            noFill();
            
            beginShape();
            for (let i = 0; i < values.length; i++) {
                let x = map(i, 0, values.length - 1, 10, 190);
                let minVal = Math.min(...values);
                let maxVal = Math.max(...values);
                if (minVal === maxVal) {
                    minVal -= 1;
                    maxVal += 1;
                }
                let y = map(values[i], minVal, maxVal, 80, 20);
                vertex(x, y);
                
                fill(100, 255, 218);
                ellipse(x, y, 3, 3);
                noFill();
            }
            endShape();
        }
        
        // Handle Enter key in input field
        document.getElementById('functionInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                updateVisualization();
            }
        });
    </script>
</body>
</html>
